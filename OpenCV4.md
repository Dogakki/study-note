![ã€Šopencvç®—æ³•ç²¾è§£ã€‹å…¨ä¹¦ç¬”è®°](https://picx.zhimg.com/70/v2-b48669c57de9e5fb054f638e2d553726_1440w.image?source=172ae18b&biz_tag=Post)

![](E:\typora\Project\OpenCV4.assets\2.jpg)

# äºŒã€å›¾åƒæ•°å­—åŒ–

## 2.1 è®¤è¯†OpenCVä¸­çš„Matç±»

### 2.1.1 åˆè¯†Mat

æ„é€ Matå¯¹è±¡ç›¸å½“äºæ„é€ äº†ä¸€ä¸ªçŸ©é˜µï¼ˆæ•°ç»„ï¼‰ï¼Œéœ€è¦å››ä¸ªåŸºæœ¬è¦ç´ ï¼šè¡Œæ•°ã€åˆ—æ•°ã€é€šé“æ•°åŠå…¶æ•°æ®ç±»å‹

```c++
Mat(int rows,int cols,int type)
```

- rows çŸ©é˜µçš„è¡Œæ•°
- cols çŸ©é˜µçš„åˆ—æ•°
- type ç±»å‹ï¼ˆåŒ…æ‹¬é€šé“æ•°åŠæ•°æ®ç±»å‹ï¼‰

â€‹		å¯ä»¥è®¾ç½®ä¸ºCV_8UC(n)ã€CV_8SC(n)ã€CV_16SC(n)ã€CV_16UC(n)ã€CV_32SC(n)ã€CV_32FC(n)ã€CV_64FC(n)

â€‹			å…¶ä¸­æ•°å­—ä»£è¡¨ä¸€ä¸ªæ•°å€¼ä»£è¡¨çš„bitæ•°ï¼Œä¸€å­—èŠ‚=8Bitã€‚

â€‹			æ‰€ä»¥32Fæ˜¯4å­—èŠ‚çš„floatç±»å‹ï¼Œ64Fæ˜¯8å­—èŠ‚çš„doubleç±»å‹ã€32Sæ˜¯å 4å­—èŠ‚çš„intç±»å‹ã€‚

â€‹			C(n)ä»£è¡¨é€šé“æ•°ï¼Œå½“n=1æ—¶ï¼Œå³æ„é€ å•é€šé“çŸ©é˜µæˆ–è€…ç§°äºŒç»´çŸ©é˜µï¼›n>1æ—¶ï¼Œæ„é€ å¤šé€šé“çŸ©é˜µå³ä¸‰ç»´çŸ©é˜µã€‚

äºæ˜¯æ„é€ Matä¹Ÿå¯ä»¥é‡‡å–ä»¥ä¸‹å½¢å¼

```c
Mat(Size(int cols,int rows),int type)
```

### 2.1.2 æ„é€ å•é€šé“Matå¯¹è±¡

ç›´æ¥æ„é€ 

```C
Mat m = Mat(2,3,CV_32FC1);
```

å€ŸåŠ©Sizeæ„é€ 

```c
Mat m;
m.create(2,3,CV_32FC1);
```

æ„é€ å…¨æ˜¯1çš„çŸ©é˜µ

```c
Mat o=Mat::ones(2,3,CV_32FC1);
```

æ„é€ å…¨æ˜¯0çš„çŸ©é˜µ

```
Mat o=Mat::zeros(2,3,CV_32FC1);
```

### 2.1.3 è·å–å•é€šé“Matçš„åŸºæœ¬ä¿¡æ¯

ä½¿ç”¨rowså’Œcolsè·å–çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°

```c++
Mat m=(Mat_<int>(3,2)<<11,12,33,43,51,16);
cout<<"è¡Œæ•°"<<m.rows;
cout<<"åˆ—æ•°"<<m.cols;
```

ä½¿ç”¨size()è·å–çŸ©é˜µçš„å°ºå¯¸

```c
Size size=m.size()
cout<<"å°ºå¯¸ï¼š"<<size<<endl;
```

ä½¿ç”¨channels()è·å–çŸ©é˜µçš„é€šé“æ•°

```c
cout<<"é€šé“æ•°"<<m.channels()<<end;
```

æˆå‘˜å‡½æ•°total() é¢ç§¯=è¡Œæ•°ä¹˜ä»¥åˆ—æ•°

```c++
cout<<"é¢ç§¯"<<m.total()<<endl;
```

æˆå‘˜å‡½æ•°dimsä»£è¡¨çŸ©é˜µçš„ç»´æ•°

```c
cout<<"ç»´æ•°"<<m.dims<<endl;
```



## 2.4 å½©è‰²å›¾åƒæ•°å­—åŒ–

#### cv::split

å¸¸ç”¨äºå›¾åƒé€šé“çš„åˆ†ç¦»ï¼Œå¦å¤–ï¼Œcv::merge()ç”¨äºå®ç°å›¾åƒé€šé“çš„åˆå¹¶ï¼Œæ˜¯splitçš„é€†å‘æ“ä½œã€‚

```c++
void split
(
    InputArray;
    OutputArrayOfArrays mv;
);
```

- m æ˜¯è¾“å…¥çš„éœ€è¦åˆ†ç¦»é€šé“çš„å›¾åƒã€‚
- mv æ˜¯è¾“å‡ºçš„vectorå®¹å™¨ï¼Œè£…è½½ä¸åŒé€šé“çš„å›¾åƒä¿¡æ¯ã€‚

```c++
#include<opencv2/core/core.hpp>
#include<opencv2/highgui/highgui.hpp>
using namespace cv;

int main(int argc, char* argv[])
{
	//è¾“å…¥å›¾åƒçŸ©é˜µ
	//æ³¨æ„OpenCV4ä¸­ä¸ºIMREAD_GRAYSCALE
	std::string path = "F:\\Visuo studio\\Project\\Opencv\\Photo\\2.jpg";
	cv::Mat img = cv::imread(path, cv::IMREAD_GRAYSCALE);
	if (img.empty())
	{
		return -1;
	}
	//æ˜¾ç¤ºå½©è‰²å›¾åƒ
	imshow("BGR", img);
	//åˆ†ç¦»é€šé“
	std::vector<Mat> planes;
	cv:split(img, planes);
	//æ˜¾ç¤ºBé€šé“
	imshow("B", planes[0]);
	//æ˜¾ç¤ºGé€šé“
	imshow("G", planes[1]);
	//æ˜¾ç¤ºRé€šé“
	imshow("R", planes[2]);
	waitKey(0);

}
```



# ä¸‰ã€å‡ ä½•å˜æ¢

## 1.è®¡ç®—ä»¿å°„å˜æ¢

### 1.1 ä»¿å°„æ³•

```c++
//åŸä½ç½®åæ ‡
Point2f src[]={Point2f(0,0),Point2f(200,0),Point2f(0,200)};
//ç»è¿‡æŸä»¿å°„å˜æ¢åçš„åæ ‡
Point2f dst[]={Point2f(0,0),Point2f(200,0),Point2f(0,200)};
//è®¡ç®—ä»¿å°„çŸ©é˜µ
Mat A = getAffineTransform(src,dst);
```

### 1.2çŸ©é˜µæ³•

```c++
Mat s=(Mat_<float>(3,3)<<0.5,0,0,0,0.5,0,0,0,2);//ç¼©æ”¾çŸ©é˜µ
Mat t=(Mat_<float>(3,3)<<1,0,100,0,1,200,0,0,1);//ç¼©æ”¾çŸ©é˜µ
Mat A;
gemm(s,t,1.0,Mat(),0,A,0);//çŸ©é˜µç›¸ä¹˜
```

# å››ã€å¯¹æ¯”åº¦å¢å¼º

## 5.å…¨å±€ç›´æ–¹å›¾å‡è¡¡åŒ–

`CV_Assert()`æ˜¯OpneCVä¸­çš„å¸¦å‚æ•°å®å®šä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šè‹¥æ‹¬å·ä¸­çš„è¡¨è¾¾å¼å€¼ä¸ºfalseï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¹¶ç»ˆæ­¢ç¨‹åºæ‰§è¡Œã€‚

`CV_8UC1`çš„å®šä¹‰ï¼š

bit_depthâ€”æ¯”ç‰¹æ•°â€”ä»£è¡¨8bite,16bites,32bites,64bites                                                                                                         ä¸¾ä¸ªä¾‹å­å§â€“æ¯”å¦‚è¯´,ä½ ç°åœ¨åˆ›å»ºäº†ä¸€ä¸ªå­˜å‚¨â€“ç°åº¦å›¾ç‰‡çš„Matå¯¹è±¡,è¿™ä¸ªå›¾åƒçš„å¤§å°ä¸ºå®½100,é«˜100,é‚£ä¹ˆ,ç°åœ¨è¿™å¼ ç°åº¦å›¾ç‰‡ä¸­æœ‰10000ä¸ªåƒç´ ç‚¹ï¼Œå®ƒæ¯ä¸€ä¸ªåƒç´ ç‚¹åœ¨å†…å­˜ç©ºé—´æ‰€å çš„ç©ºé—´å¤§å°æ˜¯8bite,8ä½â€“æ‰€ä»¥å®ƒå¯¹åº”çš„å°±æ˜¯CV_8

S|U|Fâ€“S--ä»£è¡¨â€”signed intâ€”æœ‰ç¬¦å·æ•´å½¢
Uï¼šä»£è¡¨â€“unsigned intâ€“æ— ç¬¦å·æ•´å½¢
Fï¼šä»£è¡¨â€“float---------å•ç²¾åº¦æµ®ç‚¹å‹

C<number_of_channels>----ä»£è¡¨ä¸€å¼ å›¾ç‰‡çš„é€šé“æ•°,æ¯”å¦‚:
1ï¼šç°åº¦å›¾ç‰‡â€“grayImgâ€”æ˜¯â€“å•é€šé“å›¾åƒ
2ï¼šRGBå½©è‰²å›¾åƒ---------æ˜¯â€“3é€šé“å›¾åƒ
3ï¼šå¸¦Alphé€šé“çš„RGBå›¾åƒâ€“æ˜¯--4é€šé“å›¾åƒ



# äº”ã€å›¾åƒå¹³æ»‘



# å…­ã€é˜ˆå€¼åˆ†å‰²

â€‹		æŠŠå›¾åƒåˆ†å‰²æˆè‹¥å¹²ä¸ªç‰¹å®šçš„ã€å…·æœ‰ç‹¬ç‰¹æ€§è´¨çš„åŒºåŸŸï¼Œæ¯ä¸€ä¸ªåŒºåŸŸä»£è¡¨ä¸€ä¸ªåƒç´ çš„é›†åˆï¼Œæ¯ä¸€ä¸ªé›†åˆåˆä»£è¡¨ä¸€ä¸ªç‰©ä½“ï¼Œè€Œå®Œæˆè¯¥è¿‡ç¨‹çš„æŠ€æœ¯é€šå¸¸è¢«ç§°ä¸ºå›¾åƒåˆ†å‰²ã€‚

â€‹		å›¾åƒåˆ†å‰²çš„æ–¹å¼æœ‰ä»¥ä¸‹å››ç§ï¼šåŸºäºé˜ˆå€¼çš„åˆ†å‰²æ–¹æ³•ã€åŸºäºåŒºåŸŸçš„åˆ†å‰²æ–¹æ³•ã€åŸºäºè¾¹ç¼˜çš„åˆ†å‰²æ–¹æ³•ã€åŸºäºç‰¹å®šç†è®ºçš„åˆ†å‰²æ–¹æ³•ã€‚ä»¥ä¸‹é‡ç‚¹ä»‹ç»åŸºäºé˜ˆå€¼çš„åˆ†å‰²æ–¹æ³•ã€‚

â€‹		åŸºäºé˜ˆå€¼çš„åˆ†å‰²æ–¹æ³•ï¼š

â€‹		é˜ˆå€¼åˆ†å‰²æ˜¯ä¸€ç§åŸºäºåŒºåŸŸçš„ã€ç®€å•çš„é€šè¿‡ç°åº¦å€¼ä¿¡æ¯æå–å½¢çŠ¶çš„æŠ€æœ¯ã€‚å¾€å¾€é˜ˆå€¼åˆ†å‰²åçš„è¾“å‡ºå›¾åƒåªæœ‰ä¸¤ç§ç°åº¦å€¼ï¼š255å’Œ0ã€‚æ‰€ä»¥é˜ˆå€¼åˆ†å‰²åˆå¸¸ç§°ä¸ºå›¾åƒçš„äºŒå€¼åŒ–å¤„ç†ã€‚

## 6.1 æ–¹æ³•æ¦‚è¿°

### 6.1.1	å…¨å±€é˜ˆå€¼åˆ†å‰²

â€‹		å…¨å±€é˜ˆå€¼åˆ†å‰²æŒ‡çš„æ˜¯å°†ç°åº¦å€¼å¤§äºthresh(é˜ˆå€¼)çš„åƒç´ è®¾ä¸ºç™½è‰²ï¼Œå°äºæˆ–è€…ç­‰äºé˜ˆå€¼çš„åƒç´ è®¾ä¸ºé»‘è‰²ï¼›æˆ–è€…åè¿‡æ¥å°†å¤§äºé˜ˆå€¼çš„åƒç´ è®¾ä¸ºé»‘è‰²ï¼Œå°äºæˆ–è€…ç­‰äºé˜ˆå€¼çš„åƒç´ è®¾ä¸ºç™½è‰²ã€‚

â€‹		åˆ†å‰²æ­¥éª¤ï¼šè®¾å®šé˜ˆå€¼-->å›¾åƒå¤„ç†

â€‹		OpenCVä¸­æä¾›äº†ç›¸å¯¹åº”çš„å‡½æ•°`threshold`è¿›è¡Œå…¨å±€é˜ˆå€¼åˆ†å‰²ã€‚

### 6.1.2   é˜ˆå€¼å‡½æ•°threshold

```c
threshold(InputArray src,OutputArray dst,double thresh,double maxval,int type)
```

â€‹	**thresh:**ä¸ºè®¾å®šçš„é˜ˆå€¼ï¼Œå–å€¼èŒƒå›´å³ä¸ºç°åº¦å€¼çš„èŒƒå›´0~255ï¼Œæ•°æ®ç±»å‹ä¸ºæµ®ç‚¹å‹ï¼ˆè¾“å…¥å¯ä»¥ä¸ºæ•´å‹ï¼‰ï¼›

â€‹    **result:**ä¸ºè¿›è¡Œé˜ˆå€¼åˆ†å‰²åçš„ç»“æœå›¾åƒï¼Œæ•°æ®ç±»å‹ä¸ºæ•´æ•°çŸ©é˜µï¼›

â€‹    **src:**ä¸ºè¢«è¿›è¡Œåˆ†å‰²çš„æºå›¾åƒï¼Œä¸€èˆ¬ä¸ºå•é€šé“çš„ç°åº¦å›¾ï¼Œä½†ä¸‰é€šé“çš„RGBå›¾åƒä¹Ÿå¯ä»¥è¿›è¡Œå¤„ç†ï¼ˆä½†å¯èƒ½åªæ ¹æ®ç¬¬ä¸€ä¸ªé€šé“çš„å¤§å°è¿›è¡Œå¤„ç†ï¼ˆæ‰€è°“æªæ‰“å‡ºå¤´é¸Ÿï¼‰ï¼‰

â€‹     **maxval:**ä¸ºæœ€å¤§å€¼ï¼Œä¸ºåˆ†å‰²åçš„å›¾åƒæ‰€å–åˆ°çš„ç°åº¦æœ€å¤§å€¼

â€‹     **type:**ä¸ºé˜ˆå€¼åˆ†å‰²çš„ç±»å‹ï¼Œå¸¸ç”¨çš„æœ‰THRESH_BINARYã€THRESH_BINARY_INVã€THRESH_TOZEROã€THRESH_TOZERO_INVã€‚å…·ä½“çš„è¯´æ˜å¯è§ä¸‹è¡¨æ‰€ç¤ºï¼š

| THRESH_BINARY_INV | ç°åº¦å€¼ä¸è¶…è¿‡é˜ˆå€¼çš„åƒç´ è®¾ç½®ä¸ºæœ€å¤§ç°åº¦å€¼ï¼Œè¶…è¿‡çš„è®¾ç½®ä¸º0     |
| ----------------- | --------------------------------------------------------- |
| THRESH_TOZERO     | ç°åº¦å€¼ä½äºé˜€å€¼çš„åƒç´ è®¾ä¸º0ç°åº¦å€¼                           |
| THRESH_TOZERO_INV | ç°åº¦å€¼é«˜äºé˜€å€¼çš„åƒç´ è®¾ä¸º0ç°åº¦å€¼                           |
| THRESH_TRUNC      | ç°åº¦å€¼è¶…è¿‡é˜ˆå€¼çš„åƒç´ è®¾ä¸ºé˜ˆå€¼çš„ç°åº¦å€¼                      |
| THRESH_MASK       | æ©ç                                                       |
| THRESH_OTSU       | æ ‡è®°ï¼Œä½¿ç”¨å¤§æ´¥ç®—æ³•æ¥é€‰æ‹©æœ€ä½³é˜ˆå€¼ï¼Œåªæ”¯æŒ8ä½å•é€šé“å›¾åƒ     |
| THRESH_TRIANGLE   | æ ‡è®°ï¼Œä½¿ç”¨TRIANGLEç®—æ³•æ¥ç®—åˆ™æœ€ä½³é˜ˆå€¼ï¼Œåªæ”¯æŒ8ä½å•é€šé“å›¾åƒ |
| THRESH_BINARY     | ç°åº¦å€¼è¶…è¿‡é˜ˆå€¼çš„åƒç´ è®¾ç½®ä¸ºæœ€å¤§ç°åº¦å€¼ï¼Œä¸è¶…è¿‡çš„è®¾ç½®ä¸º0     |

```c
void GlobalTreshold()
{
	//è¾“å…¥çŸ©é˜µä¸º5 è¡Œ 3åˆ—
	Mat src = (Mat_<uchar>(5, 3) << 123, 234, 68, 33, 51, 17, 48, 98, 234, 129, 89, 27, 45, 167, 134);
	//ç¬¬ä¸€ç§æƒ…å†µï¼šæ‰‹åŠ¨è®¾ç½®é˜ˆå€¼
	double the = 150;
	Mat dst;
	threshold(src, dst, the, 255, THRESH_BINARY);
	//ç¬¬äºŒç§æƒ…å†µï¼šOtsuç®—æ³•
	double otsuThe = 0;
	Mat dst_Otsu;
	otsuThe = threshold(src, dst_Otsu, otsuThe, 255, THRESH_OTSU + THRESH_BINARY);
	cout << "è®¡ç®—çš„OTSUé˜ˆå€¼" << otsuThe<< endl;
	//ç¬¬ä¸‰ç§æƒ…å†µï¼šTRIANGLE ç®—æ³•
	double triThe = 0;
	Mat dst_tri;
	triThe = threshold(src, dst_tri, 0, 255, THRESH_TRIANGLE + THRESH_BINARY);
	cout << "è®¡ç®—çš„TRIANGLEé˜ˆå€¼" << triThe << endl;

}
```

### 6.1.3 å±€éƒ¨é˜ˆå€¼åˆ†å‰²

â€‹		åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¦‚å—å…‰ç…§ä¸å‡ç­‰å› ç´ å½±å“ï¼Œéœ€è¦è¿›è¡Œå±€éƒ¨é˜ˆå€¼åˆ†å‰²ã€‚å®ƒä¸åƒå…¨å±€åˆ†å‰²ä¸€æ ·ï¼Œå¯¹æ•´ä¸ªçŸ©é˜µåªæœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œå®ƒé’ˆå¯¹è¾“å…¥çŸ©é˜µçš„æ¯ä¸€ä¸ªä½ç½®çš„å€¼éƒ½æœ‰ç›¸å¯¹åº”çš„é˜ˆå€¼ã€‚

ä»¥ä¸‹è¯¦ç»†ä»‹ç»è‡ªåŠ¨è®¡ç®—å…¨å±€é˜ˆå€¼çš„å¸¸ç”¨æ–¹æ³•ã€‚

## 6.2	ç›´æ–¹å›¾æŠ€æœ¯æ³•

ä¸€å¹…å«æœ‰ä¸€ä¸ªä¸èƒŒæ™¯å‘ˆç°æ˜æ˜¾å¯¹æ¯”çš„ç‰©ä½“çš„å›¾åƒå…·æœ‰åŒ…å«åŒå³°çš„ç›´æ–¹å›¾ï¼Œä¸¤ä¸ªå³°å€¼å¯¹åº”äºç‰©ä½“å†…éƒ¨å’Œå¤–éƒ¨è¾ƒå¤šæ•°ç›®çš„ç‚¹ï¼Œä½†ç”±äºç›´æ–¹å›¾åœ¨ç›´æ–¹å›¾çš„éšæœºæ³¢åŠ¨ï¼Œä¸¤ä¸ªæ³¢å³°ï¼ˆå±€éƒ¨æœ€å¤§å€¼ï¼‰å’Œæ³¢è°·ï¼ˆå±€éƒ¨æœ€å°å€¼ï¼‰ä¸å¥½ç¡®å®š

<img src="https://img-blog.csdnimg.cn/20210109172316594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDA3Njk1,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 33%;" />

### 6.2.1 åŸç†è¯¦è§£

ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°ç°åº¦ç›´æ–¹å›¾çš„ç¬¬ä¸€ä¸ªå³°å€¼ï¼Œå¹¶æ‰¾åˆ°å…¶å¯¹åº”çš„ç°åº¦å€¼ã€‚æ˜¾ç„¶ï¼Œç°åº¦ç›´æ–¹å›¾çš„æœ€å¤§å€¼å°±æ˜¯ç¬¬ä¸€ä¸ªå³°å€¼ä¸”å¯¹åº”çš„ç°åº¦å€¼ç”¨firstPeakè¡¨ç¤ºã€‚

ç¬¬äºŒæ­¥ï¼šæ‰¾åˆ°ç°åº¦ç›´æ–¹å›¾çš„ç¬¬äºŒä¸ªå³°å€¼ï¼Œå¹¶æ‰¾åˆ°å…¶å¯¹åº”çš„ç°åº¦å€¼ã€‚ç¬¬äºŒä¸ªå³°å€¼ä¸ä¸€å®šæ˜¯ç›´æ–¹å›¾çš„ç¬¬äºŒå¤§å€¼ï¼Œå› ä¸ºå®ƒå¾ˆå¯èƒ½å‡ºç°åœ¨ç¬¬ä¸€ä¸ªå³°å€¼çš„é™„è¿‘ã€‚

ç¬¬ä¸‰æ­¥ï¼šæ‰¾åˆ°è¿™ä¸¤ä¸ªå³°å€¼ä¹‹é—´çš„æ³¢è°·ï¼Œå¦‚æœå‡ºç°ä¸¤ä¸ªæˆ–è€…å¤šä¸ªæ³¢è°·ï¼Œåˆ™å–å·¦ä¾§çš„æ³¢è°·å³å¯ï¼Œå…¶å¯¹åº”çš„ç°åº¦å€¼å³ä¸ºé˜ˆå€¼ã€‚

### 6.2.2 c++å®ç°

```c
Mat calcGrayHist(const Mat & image)
{
    Mat histogram = Mat::zeros(Size(256, 1), CV_32SC1);
    int rows = image.rows;
    int cols = image.cols;
    for (int r = 0; r < rows; r++)
    {
        for (int c = 0; c < cols; c++)
        {
            int index = int(image.at<uchar>(r, c));
            histogram.at<int>(0, index) += 1;
        }
    }
    return histogram;
}

int threshTwoPeaks(const Mat& image, Mat& thresh_out)
{
  // è®¡ç®—ç°åº¦ç›´æ–¹å›¾
  Mat histogram = calcGrayHist(image);
  // æ‰¾åˆ°ç°åº¦ç›´æ–¹å›¾æœ€å¤§å³°å€¼å¯¹åº”çš„ç°åº¦å€¼
  Point firstPeakLoc;
  minMaxLoc(histogram, NULL, NULL, NULL, &firstPeakLoc);
  int firstPeak = firstPeakLoc.x;
  //å¯»æ‰¾ç°åº¦ç›´æ–¹å›¾çš„ç¬¬äºŒä¸ªå³°å€¼å¯¹åº”çš„ç°åº¦å€¼
  Mat measureDists = Mat::zeros(Size(256,1), CV_32FC1);
  for(int k=0;k<256;k++)
  {
    int hist_k = histogram.at<int>(0,k);
    measureDists.at<float>(0,k) = pow(float(k-firstPeak), 2) * hist_k;
  }
  Point secondPeakLoc;
  minMaxLoc(measureDists, NULL, NULL, NULL, &secondPeakLoc);
  int secondPeak = secondPeakLoc.x;
  //æ‰¾åˆ°ä¸¤ä¸ªå³°å€¼ä¹‹é—´çš„æœ€å°å€¼å¯¹åº”çš„ç°åº¦å€¼ï¼Œä½œä¸ºé˜ˆå€¼
  Point threshLoc;
  int thresh = 0;
  if(firstPeak < secondPeak){
    minMaxLoc(histogram.colRange(firstPeak, secondPeak), NULL, NULL, &threshLoc);
    thresh = firstPeak + threshLoc.x + 1;
  }else{
    minMaxLoc(histogram.colRange(secondPeak, firstPeak), NULL, NULL, &threshLoc);
    thresh = secondPeak + threshLoc.x + 1;
  }
  //é˜ˆå€¼åˆ†å‰²
  threshold(image, thresh_out, thresh, 255, THRESH_BINARY);
  return thresh;
}

```

## 6.3 ç†µç®—æ³•

### 6.3.1 åŸç†è¯¦è§£

ä¿¡æ¯ç†µçš„æ¦‚å¿µæ¥æºäºä¿¡æ¯è®ºï¼Œå‡è®¾ä¿¡æºç¬¦å·uæœ‰Nç§å–å€¼ï¼Œè®°ä¸º
$$
p_1,p_2,...,p_N
$$
é‚£ä¹ˆè¯¥ä¿¡æ¯æºçš„ä¿¡æ¯ç†µï¼Œè®°ä¸º
$$
entropy(u)=-âˆ‘Np_ilogp_i
$$
â€‹		å›¾åƒä¹Ÿå¯ä»¥çœ‹ä½œä¸€ç§ä¿¡æºï¼ŒæŠŠä¿¡æ¯ç†µçš„æ¦‚å¿µå¸¦å…¥å›¾åƒå°±æ˜¯ï¼Œå›¾åƒçš„ä¿¡æ¯ç†µè¶Šå¤§ï¼ˆä¿¡æ¯é‡å¤§ï¼‰ï¼Œæ‰€åŒ…å«çš„ç»†èŠ‚è¶Šå¤šï¼Œå›¾åƒå°±è¶Šæ¸…æ™°ã€‚å‡è®¾è¾“å…¥å›¾åƒä¸º *I*ï¼ŒnormHist_I ä»£è¡¨å½’ä¸€åŒ–çš„å›¾åƒç°åº¦ç›´æ–¹å›¾ï¼Œé‚£ä¹ˆå¯¹äº 8 ä½å›¾å¯ä»¥çœ‹æˆç”± 256 ä¸ªç°åº¦ç¬¦å·ï¼Œä¸”æ¯ä¸€ä¸ªç¬¦å·å‡ºç°çš„æ¦‚ç‡ä¸º normHist I ( k ) ç»„æˆçš„ä¿¡æºã€‚

â€‹		åˆ©ç”¨ç†µè®¡ç®—é˜ˆå€¼çš„æ­¥éª¤å¦‚ä¸‹ï¼š

â€‹		ç¬¬ä¸€æ­¥ï¼šè®¡ç®—Içš„ç´¯åŠ æ¦‚ç‡ç›´æ–¹å›¾ï¼Œåˆç§°ä¸ºé›¶é˜¶ç´¯ç§¯çŸ©ï¼Œè®°ä¸º
$$
cumuHist(k)=-âˆ‘p_ilogp_i,kâˆˆ[0,255]
$$
â€‹		ç¬¬äºŒæ­¥ï¼šè®¡ç®—å„ä¸ªç°åº¦çº§çš„ç†µï¼Œè®°ä¸ºï¼š
$$
entropy(t)=-âˆ‘normHist_I(k)log(normHist_I(k)),0â‰¤tâ‰¤255
$$
â€‹		ç¬¬ä¸‰æ­¥

![image-20231216145020811](E:\typora\Project\OpenCV4.assets\image-20231216145020811.png)



## 6.4 OTSUé˜ˆå€¼åˆ†å‰²

### 6.4.1 åŸç†è¯¦è§£

 	  è¿™ä¸ªå¤„ç†æ˜¯ä¸ºäº†å…‹æœæˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®çš„é˜ˆå€¼xå¯¹å½“å‰å›¾åƒæ¥è¯´ä¸åˆç†çš„æƒ…å†µã€‚æ¯”å¦‚å½“å‰å›¾åƒçš„åƒç´ å€¼éƒ½å¤§äº125ï¼Œç„¶åæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ä¸º125ï¼Œç”¨äºŒå€¼åŒ–å¤„ç†ï¼Œåˆ™å›¾åƒçš„åƒç´ å€¼éƒ½ä¼šå˜ä¸º255ï¼Œå…¶å›¾åƒæ˜¯ä¸€ä¸ªç™½æ¿ï¼Œè¿™æ ·è¿›è¡Œé˜ˆå€¼å¤„ç†æ˜¯ä¸å¯å–çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡Otsuè¿›è¡Œå¤„ç†ï¼Œå¯ä»¥æ ¹æ®å½“å‰å›¾åƒä¸­çš„æ‰€æœ‰åƒç´ å€¼ï¼Œè®¾å®šä¸€ä¸ªæœ€ä¼˜çš„é˜ˆå€¼ï¼Œå®ƒä¼šç»¼åˆè€ƒè™‘æ‰€æœ‰å¯èƒ½çš„é˜ˆå€¼ã€‚

### 6.4.2 ä»£ç è¯¦è§£

```c++
//Otsu é˜ˆå€¼å¤„ç†ï¼šå¾—åˆ°é˜ˆå€¼å¤„ç†åçš„äºŒå€¼å›¾ OtsuThreshImageï¼Œå¹¶è¿”å›åˆ†å‰²é˜ˆå€¼
int otsu(const Mat& image, Mat& OtsuThreshImage)
{
	//è®¡ç®—ç°åº¦ç›´æ–¹å›¾
	Mat histogram = calcGrayHist(image);
	//å½’ä¸€åŒ–ç°åº¦ç›´æ–¹å›¾
	Mat normHist;
	histogram.convertTo(normHist, CV_32FC1, 1.0 / (image.rows * image.cols), 0.0);
	//è®¡ç®—ç´¯åŠ ç›´æ–¹å›¾(é›¶é˜¶ç´¯åŠ çŸ©)å’Œä¸€é˜¶ç´¯åŠ çŸ©
	Mat zeroCumuMoment = Mat::zeros(Size(256, 1), CV_32FC1);
	Mat oneCumuMoment = Mat::zeros(Size(256, 1), CV_32FC1);
	for (int i = 0; i < 256; i++)
	{
		if (i == 0)
		{
			zeroCumuMoment.at<float>(0, i) = normHist.at<float>(0, i);
			oneCumuMoment.at<float>(0, i) = i * normHist.at<float>(0, i);
		}
		else
		{
			zeroCumuMoment.at<float>(0, i) = zeroCumuMoment.at<float>(0, i - 1) + normHist.at<float>(0, i);
			oneCumuMoment.at<float>(0, i) = oneCumuMoment.at<float>(0, i - 1) + i * normHist.at<float>(0, i);
		}
	}
	//è®¡ç®—ç±»é—´æ–¹å·®
	Mat variance = Mat::zeros(Size(256, 1), CV_32FC1);
	//æ€»å¹³å‡å€¼
	float mean = oneCumuMoment.at<float>(0, 255);
	for (int i = 0; i < 255; i++)
	{
		if (zeroCumuMoment.at<float>(0, i) == 0 || zeroCumuMoment.at<float>(0, i) == 1)
			variance.at<float>(0, i) = 0;
		else
		{
			float cofficient = zeroCumuMoment.at<float>(0, i) * (1.0 - zeroCumuMoment.at<float>(0, i));
			variance.at<float>(0, i) = pow(mean * zeroCumuMoment.at<float>(0, i) - oneCumuMoment.at<float>(0, i), 2.0) / cofficient;
		}
	}
	//æ‰¾åˆ°é˜ˆå€¼
	Point maxLoc;
	minMaxLoc(variance, NULL, NULL, NULL, &maxLoc);
	int otsuThresh = maxLoc.x;
	//é˜ˆå€¼å¤„ç†
	threshold(image, OtsuThreshImage, otsuThresh, 255, THRESH_BINARY);
	return otsuThresh;
}


```

## 6.5 è‡ªé€‚åº”é˜ˆå€¼

### 6.5.1 åŸç†è¯¦è§£

â€‹		æˆ‘ä»¬åœ¨è¿›è¡Œé˜ˆå€¼å¤„ç†æ—¶ï¼Œå¦‚æœè¯´æˆ‘ä»¬çš„å›¾åƒè‰²å½©ä¸å‡è¡¡çš„è¯ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé˜ˆå€¼xï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆçš„åˆ†å‰²ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªé€‚åº”é˜ˆå€¼å¤„ç†ï¼Œå®ƒå°±åƒä¸€ä¸ªæ©è†œï¼Œå…³äºæ©è†œæ¦‚å¿µä¸æ‡‚å¾—è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„å›¾åƒå¤„ç†ç¬”è®°03ï¼Œè¿™ç§é˜ˆå€¼çš„å¤„ç†æ˜¯æ ¹æ®å½“å‰åƒç´ ç‚¹çš„å‘¨å›´é‚»åŸŸå†…çš„åƒç´ å€¼çš„åŠ æƒå¹³å‡ï¼Œè·å¾—ä¸€ä¸ªé˜ˆå€¼ï¼Œè·å¾—é˜ˆå€¼ä¹‹åçš„æ“ä½œå°±å’Œå‰é¢çš„ä¸€æ ·äº†ã€‚

### 6.5.2 ä»£ç è¯¦è§£

```c
Mat adaptiveThreshold_S(const Mat& image, Size blockSize, float ratio)
{
	//å›¾åƒçš„å®½é«˜
	int rows = image.rows;
	int cols = image.cols;
	//é˜ˆå€¼å¤„ç†åçš„äºŒå€¼å›¾
	Mat threshImage = Mat::zeros(image.size(), CV_8UC1);
	//
	int h = (blockSize.height - 1) / 2;
	int w = (blockSize.width - 1) / 2;
	//å›¾åƒçš„ç§¯åˆ†
	Mat imageIntegral;
	integral(image, imageIntegral, CV_32FC1);
	imageIntegral = imageIntegral(Rect(1, 1, cols, rows)).clone();

for (int r = 0; r < rows; r++)
{
	for (int c = 0; c < cols; c++)
	{
		int tl_r = r - h > 0 ? r - h : 0;
		int tl_c = c - w > 0 ? c - w : 0;
		int br_r = r + h < rows ? r + h : rows - 1;
		int br_c = c + w < cols ? c + w : cols - 1;
		//è®¡ç®—åŒºåŸŸå’Œ
		float regionSum = imageIntegral.at<float>(br_r, br_c) +
			imageIntegral.at<float>(tl_r, tl_c) -
			imageIntegral.at<float>(tl_r, br_c) -
			imageIntegral.at<float>(br_r, tl_c);
		int count = (br_r - tl_r + 1) * (br_c - tl_c + 1);
		int pixel = int(image.at<uchar>(r, c));
		if (pixel * count < (1 - ratio) * regionSum)
			threshImage.at<uchar>(r, c) = 0;
		else
			threshImage.at<uchar>(r, c) = 255;
	}
}
return threshImage;

}
//è‡ªé€‚åº”é˜ˆå€¼åˆ†å‰²
Mat adaptiveThresh(Mat I, int radius, float ratio, METHOD method)
{
	//ç¬¬ä¸€æ­¥ï¼šå›¾åƒçŸ©é˜µçš„å¹³æ»‘å¤„ç†
	Mat I_smooth;
	switch (method)
	{
	case MEAN:
		boxFilter(I, I_smooth, CV_32FC1, Size(2 * radius + 1, 2 * radius + 1));//å‡å€¼å¹³æ»‘
		break;
	case GAUSS:
		GaussianBlur(I, I_smooth, Size(2 * radius + 1, 2 * radius + 1), 0, 0);//é«˜æ–¯å¹³æ»‘
		I_smooth.convertTo(I_smooth, CV_32FC1);
		break;
	case MEDIAN:
		medianBlur(I, I_smooth, 2 * radius + 1);//ä¸­å€¼å¹³æ»‘
		I_smooth.convertTo(I_smooth, CV_32FC1);
		break;
	default:
		break;
	}
	//ç¬¬äºŒæ­¥ï¼šå¹³æ»‘ç»“æœä¹˜ä»¥æ¯”ä¾‹ç³»æ•°ï¼Œç„¶åå›¾åƒä¸å…¶åšå·®
	I.convertTo(I, CV_32FC1);
	Mat diff = I - (1.0 - ratio) * I_smooth;
	//ç¬¬ä¸‰æ­¥ï¼šé˜ˆå€¼å¤„ç†ï¼šå¤§äºç­‰äº 0 çš„ï¼Œè¾“å‡º 255 ï¼Œåä¹‹è¾“å‡º 0
	Mat out = Mat::zeros(diff.size(), CV_8UC1);
	for (int r = 0; r < out.rows; r++)
	{
		for (int c = 0; c < out.cols; c++)
		{
			if (diff.at<float>(r, c) >= 0)
				out.at<uchar>(r, c) = 255;
		}
	}
	return out;
}
```



## 6.6 äºŒå€¼å›¾çš„é€»è¾‘è¿ç®—

### 6.6.1 â€œä¸â€å’Œâ€œæˆ–â€è¿ç®—

â€‹		å¯¹äºé˜ˆå€¼é˜ˆå€¼å¤„ç†åçš„äºŒå€¼å›¾ï¼Œè¿˜å¯ä»¥åˆ©ç”¨äºŒå€¼å›¾ä¹‹é—´çš„é€»è¾‘è¿ç®—ï¼šâ€œä¸â€è¿ç®—å’Œâ€œæˆ–â€è¿ç®—ï¼Œä»¥ä¾¿å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚

â€‹		`bitwis_and`å’Œ`bitwise_or`åˆ†åˆ«å®ç°äº†ä¸è¿ç®—å’Œæˆ–è¿ç®—ã€‚

### 6.6.2 ä»£ç è¯¦è§£

```c
Mat src1 = Mat::zeros(Size(100, 100), CV_8UC1);
	cv::rectangle(src1, Rect(25, 25, 50, 50), Scalar(255), CV_FILLED);
	imshow("src1", src1);
	Mat src2 = Mat::zeros(Size(100, 100), CV_8UC1);
	cv::circle(src2, Point(75, 50), 25, Scalar(255), CV_FILLED);
	imshow("src2", src2);
	//ä¸è¿ç®—
	Mat dst_and;
	bitwise_and(src1, src2, dst_and);
	imshow("ä¸è¿ç®—", dst_and);
	//æˆ–è¿ç®—
	Mat dst_or;
	bitwise_or(src1, src2, dst_or);
	imshow("æˆ–è¿ç®—", dst_or);
	//éè¿ç®—
	Mat dst_not;
	bitwise_not(src1, dst_not);
	imshow("éè¿ç®—", dst_not);
	waitKey(0);
	return 0;
```



# ä¸ƒã€å½¢æ€å­¦å¤„ç†

å¸¸ç”¨çš„å½¢æ€å­¦å¤„ç†æ–¹æ³•åŒ…æ‹¬ï¼šè…èš€ã€è†¨èƒ€ã€å¼€è¿ç®—ã€é—­è¿ç®—ã€é¡¶å¸½è¿ç®—ã€åº•å¸½è¿ç®—ã€‚

å…¶ä¸­è…èš€ä¸è†¨èƒ€æ˜¯æœ€åŸºç¡€çš„æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•æ˜¯ä¸¤è€…ç›¸äº’ç»„åˆè€Œäº§ç”Ÿçš„ã€‚

## 7.1 è…èš€

### 7.1.1 åŸç†è¯¦è§£

ç»“æ„å…ƒï¼šä¸å¹³æ»‘æ“ä½œç±»ä¼¼ï¼Œåœ¨å¹³æ»‘æ“ä½œä¸­ä½¿ç”¨çš„æ˜¯çŸ©å½¢é‚»åŸŸï¼Œè€Œåœ¨å½¢æ€å­¦å¤„ç†ä¸­é‚»åŸŸå¯ä»¥æ˜¯çŸ©å½¢ç»“æ„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¤­åœ†å½¢ã€åå­—äº¤å‰å½¢ç»“æ„ã€‚åŒæ ·ä¹Ÿéœ€è¦æŒ‡å®šä¸€ä¸ªé”šç‚¹ã€‚

â€‹		åœ¨è…èš€æ“ä½œä¸­ï¼Œæ˜¯å–ç»“æ„å…ƒä¸­çš„æœ€å°å€¼ä½œä¸ºé”šç‚¹çš„å€¼ã€‚å¯ä»¥å¯¹ç°åº¦å›¾æˆ–äºŒå€¼å›¾åšè…èš€æ“ä½œã€‚

![img](https://img-blog.csdnimg.cn/20210116153011132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDA3Njk1,size_16,color_FFFFFF,t_70#pic_center)

â€‹		ä¸Šæ–¹ä¸‰ä¸ªå›¾ä¸­çš„é‚»åŸŸçš„æœ€å°å€¼åˆ†åˆ«ä¸º 11ã€21ã€21ï¼Œè¿™äº›æœ€å°å€¼è¾“å‡ºåˆ°å›¾åƒä¸­çš„é”šç‚¹ä½ç½®ï¼Œå…¶ä»–ä½ç½®é€šè¿‡ç§»åŠ¨ç»“æ„å…ƒä»¥æ­¤ç±»æ¨ï¼Œå³å¯å¾—åˆ°å®Œæ•´çš„è¾“å‡ºå›¾åƒã€‚

â€‹		ç”±ä¸Šå›¾å¯çŸ¥ï¼Œå› ä¸ºå–æ¯ä¸ªä½ç½®é‚»åŸŸå†…çš„æœ€å°å€¼ï¼Œæ‰€ä»¥è…èš€åè¾“å‡ºå›¾åƒçš„æ€»ä½“äº®åº¦çš„å¹³å‡å€¼æ¯”èµ·åŸå›¾ä¼šæœ‰æ‰€é™ä½ï¼Œå›¾åƒä¸­æ¯”è¾ƒäº®çš„åŒºåŸŸçš„é¢ç§¯ä¼šå˜å°ç”šè‡³æ¶ˆå¤±ï¼Œè€Œæ¯”è¾ƒæš—çš„åŒºåŸŸçš„é¢ç§¯ä¼šå¢å¤§ã€‚

â€‹		å› ä¸ºå¯¹å›¾åƒè¿›è¡Œè…èš€æ“ä½œåç¼©å°äº†äº®åº¦åŒºåŸŸçš„é¢ç§¯ï¼Œæ‰€ä»¥é’ˆå¯¹é˜ˆå€¼åˆ†å‰²åå‰æ™¯æ—¶ç™½è‰²çš„äºŒå€¼å›¾ï¼Œå¯ä»¥é€šè¿‡åŸå›¾ä¸è…èš€åçš„å›¾åƒç›¸å‡å¾—åˆ°å‰æ™¯çš„è¾¹ç•Œã€‚

### 7.1.2 ä»£ç è¯¦è§£

```c++
CV_EXPORTS_W void erode( InputArray src, OutputArray dst, InputArray kernel,
                         Point anchor = Point(-1,-1), int iterations = 1,
                         int borderType = BORDER_CONSTANT,
                         const Scalar& borderValue = morphologyDefaultBorderValue() );
```

æ­¤å‡½æ•°å®ç°äº†å›¾åƒçš„è…èš€

- src					è¾“å…¥çŸ©é˜µï¼Œç°åº¦å›¾æˆ–äºŒå€¼å›¾
- dst	               è¾“å‡ºçŸ©é˜µ
- kernel	          ç»“æ„å…ƒï¼Œå¯ä»¥é€šè¿‡ getStructuringElement å‡½æ•°è·å–
- anchor        	 é”šç‚¹çš„ä½ç½®ï¼›é»˜è®¤å€¼ï¼ˆ-1ï¼Œ-1ï¼‰è¡¨ç¤ºé”šç‚¹åœ¨ç»“æ„å…ƒä¸­å¿ƒã€‚
- iterations	     è…èš€çš„æ¬¡æ•°
- borderType     è¾¹ç•Œæ‰©å……ç±»å‹ï¼ˆå¯ä¸åœ¨ä½¿ç”¨çš„æ—¶å€™å£°æ˜ï¼‰
- borderValue	è¾¹ç•Œæ‰©å……å€¼ï¼ˆå¯ä¸åœ¨ä½¿ç”¨çš„æ—¶å€™å£°æ˜ï¼‰

```c
Mat cv::getStructuringElement(int 	shape,
							Size 	ksize,
							Point 	anchor = Point(-1,-1) 
							)		
```

æ­¤å‡½æ•°è¿”å›è®¾å®šçš„ç»“æ„å…ƒ

|  int shape   | ç»“æ„å…ƒå½¢çŠ¶ |
| :----------: | :--------: |
|  Size ksize  | ç»“æ„å…ƒå¤§å° |
| Point anchor | ç»“æ„å…ƒé”šç‚¹ |

æ€»ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š

```c
//è¾“å…¥å›¾åƒ
	Mat I = imread(argv[1], CV_LOAD_IMAGE_GRAYSCALE);
	if (!I.data)
		return -1;
	//åˆ›å»ºçŸ©å½¢ç»“æ„å…ƒ
	Mat s = cv::getStructuringElement(cv::MORPH_RECT, Size(3, 3));
	//è…èš€å›¾åƒ
	Mat E;
	cv::erode(I, E, s,Point(-1,-1),2);
	//æ˜¾ç¤ºå›¾åƒ
	imshow("I", I);
	imshow("erode", E);
	waitKey(0);
	return 0;


```





## 7.2 è†¨èƒ€

### 7.2.1 åŸç†è¯¦è§£

åœ¨è†¨èƒ€æ“ä½œä¸­ï¼Œæ˜¯å–ç»“æ„å…ƒä¸­çš„æœ€å¤§å€¼ä½œä¸ºé”šç‚¹çš„å€¼ã€‚å¯ä»¥å¯¹ç°åº¦å›¾æˆ–äºŒå€¼å›¾åšè†¨èƒ€æ“ä½œã€‚è†¨èƒ€åè¾“å‡ºå›¾åƒçš„æ€»ä½“äº®åº¦çš„å¹³å‡å€¼æ¯”èµ·åŸå›¾ä¼šæœ‰æ‰€ä¸Šå‡ï¼Œå›¾åƒä¸­æ¯”è¾ƒäº®çš„åŒºåŸŸçš„é¢ç§¯ä¼šå˜å¤§ï¼Œè€Œæ¯”è¾ƒæš—çš„åŒºåŸŸçš„é¢ç§¯ä¼šå‡å°ã€‚

### 7.2.2 ä»£ç è¯¦è§£

```c++
// è†¨èƒ€
// C++
void cv::dilate(InputArray 	  src,
				OutputArray   dst,
				InputArray 	  kernel,
				Point 	      anchor = Point(-1,-1),
				int 	      iterations = 1,
				int 	      borderType = BORDER_CONSTANT,
				const Scalar & 	borderValue = morphologyDefaultBorderValue() 
				)		
```

- src					è¾“å…¥çŸ©é˜µï¼Œç°åº¦å›¾æˆ–äºŒå€¼å›¾
- dst	               è¾“å‡ºçŸ©é˜µ
- kernel	          ç»“æ„å…ƒï¼Œå¯ä»¥é€šè¿‡ getStructuringElement å‡½æ•°è·å–
- anchor        	 é”šç‚¹çš„ä½ç½®ï¼›é»˜è®¤å€¼ï¼ˆ-1ï¼Œ-1ï¼‰è¡¨ç¤ºé”šç‚¹åœ¨ç»“æ„å…ƒä¸­å¿ƒã€‚
- iterations	     è…èš€çš„æ¬¡æ•°
- borderType     è¾¹ç•Œæ‰©å……ç±»å‹ï¼ˆå¯ä¸åœ¨ä½¿ç”¨çš„æ—¶å€™å£°æ˜ï¼‰
- borderValue	è¾¹ç•Œæ‰©å……å€¼ï¼ˆå¯ä¸åœ¨ä½¿ç”¨çš„æ—¶å€™å£°æ˜ï¼‰

## 7.3 å¼€è¿ç®—ä¸é—­è¿ç®—

### 7.3.1 åŸç†è¯¦è§£

â€‹		è…èš€ä¸è†¨èƒ€æ˜¯å¼€è¿ç®—ä¸é—­è¿ç®—çš„åŸºç¡€

â€‹		å¼€è¿ç®—æ˜¯å…ˆè…èš€åè†¨èƒ€çš„è¿‡ç¨‹ï¼Œå®ƒå…·æœ‰æ¶ˆé™¤é«˜åº¦è¾ƒé«˜çš„ç»†å°åŒºåŸŸã€åœ¨çº¤ç»†ç‚¹å¤„åˆ†ç¦»ç‰©ä½“ï¼Œå¯¹äºè¾ƒå¤§ç‰©ä½“ï¼Œå¯ä»¥åœ¨ä¸æ˜æ˜¾æ”¹å˜å…¶é¢ç§¯çš„æƒ…å†µä¸‹å¹³æ»‘å…¶è¾¹ç•Œç­‰ä½œç”¨ã€‚

â€‹		é—­è¿ç®—æ˜¯å…ˆè†¨èƒ€åè…èš€ï¼Œå®ƒå…·æœ‰å¡«å……ç™½è‰²ç‰©ä½“å†…ç»†å°é»‘è‰²ç©ºæ´çš„åŒºåŸŸã€è¿æ¥ä¸´è¿‘ç‰©ä½“ï¼Œç”¨ä¸€ä¸ªç»“æ„å…ƒã€å¤šæ¬¡è¿­ä»£å¤„ç†ï¼Œå¯ä»¥åœ¨ä¸æ˜æ˜¾æ”¹å˜å…¶é¢ç§¯çš„æƒ…å†µä¸‹å¹³æ»‘å…¶è¾¹ç•Œç­‰ä½œç”¨ã€‚

### 7.3.2 ä»£ç è¯¦è§£

```c++
void cv::morphologyEx(InputArray 	src,
					OutputArray 	dst,
					int 	op,
					InputArray 	kernel,
					Point 	anchor = Point(-1,-1),
					int 	iterations = 1,
					int 	borderType = BORDER_CONSTANT,
					const Scalar & 	borderValue = morphologyDefaultBorderValue() 
					)ï¼›
```

|     src     |                     è¾“å‡ºçš„å›¾ç‰‡                     |
| :---------: | :------------------------------------------------: |
|     dst     |                     è¾“å‡ºçš„å›¾ç‰‡                     |
|     op      |                  å½¢æ€å­¦æ“ä½œçš„ç±»å‹                  |
|   kernel    |  ç»“æ„å…ƒï¼Œå¯ä»¥é€šè¿‡ getStructuringElement å‡½æ•°è·å–   |
|   anchor    | é”šç‚¹çš„ä½ç½®ï¼›é»˜è®¤å€¼ï¼ˆ-1ï¼Œ-1ï¼‰è¡¨ç¤ºé”šç‚¹åœ¨ç»“æ„å…ƒä¸­å¿ƒã€‚ |
| iterations  |                      è¿­ä»£æ¬¡æ•°                      |
| borderType  |                è¾¹ç•Œæ‰©å……ç±»å‹ï¼Œè§è…èš€                |
| borderValue |                 è¾¹ç•Œæ‰©å……å€¼ï¼Œè§è…èš€                 |

op å½¢æ€å­¦æ“ä½œçš„ç±»å‹

- `MORPH_ERODE`  è…èš€ erode
- `MORPH_DILATE`  è†¨èƒ€ dilate
- `MORPH_OPEN`  å¼€è¿ç®—ï¼ˆå…ˆè…èš€åè†¨èƒ€ï¼‰
- `MORPH_CLOSE`  é—­è¿ç®—ï¼ˆå…ˆè†¨èƒ€åè…èš€ï¼‰
- `MORPH_GRADIENT`  å½¢æ€å­¦æ¢¯åº¦
- `MORPH_TOPHAT`  é¡¶å¸½è¿ç®—
- `MORPH_BLACKHAT`  åº•å¸½è¿ç®—



## 7.4 é¡¶å¸½å˜æ¢å’Œåº•å¸½å˜æ¢

### 7.4.1 åŸç†è¯¦è§£

é¡¶å¸½å˜æ¢ï¼ˆTop-hat)ä¸åº•å¸½å˜æ¢ï¼ˆBotton-hat)æ˜¯åˆ†åˆ«ä»¥å¼€è¿ç®—ä¸é—­è¿ç®—ä¸ºåŸºç¡€çš„ã€‚

**é¡¶å¸½å˜æ¢ï¼š**å›¾åƒå‡å»å¼€è¿ç®—ç»“æœï¼Œå› ä¸ºå¼€è¿ç®—å¯ä»¥æ¶ˆé™¤æš—èƒŒæ™¯ä¸‹çš„è¾ƒäº®åŒºåŸŸï¼Œé‚£ä¹ˆå¦‚æœç”¨åŸå›¾å‡å»å¼€è¿ç®—ï¼Œç»“æœå°±å¯ä»¥å¾—åˆ°åŸå›¾ä¸­ç°åº¦è¾ƒäº®çš„åŒºåŸŸã€‚

**åº•å¸½å˜æ¢ï¼š**å›¾åƒå‡å»é—­è¿ç®—ç»“æœï¼Œå› ä¸ºé—­è¿ç®—å¯ä»¥æ¶ˆé™¤è¾ƒé«˜èƒŒæ™¯ä¸‹çš„è¾ƒæš—åŒºåŸŸï¼Œé‚£ä¹ˆç”¨åŸå›¾å‡å»é—­è¿ç®—ç»“æœå°±å¯ä»¥å¾—åˆ°åŸå›¾ä¸­ç°åº¦è¾ƒæš—çš„åŒºåŸŸã€‚

### 7.4.2 ä»£ç è¯¦è§£

å¦‚7.3.2 æ‰€ç¤ºã€‚

# å…« ã€è¾¹ç¼˜æ£€æµ‹

â€‹		å›¾åƒçš„è¾¹ç¼˜æŒ‡çš„æ˜¯ç°åº¦å€¼å‘ç”Ÿæ€¥å‰§å˜åŒ–çš„ä½ç½®ï¼Œæœ‰äº›æ—¶å€™ï¼Œåªéœ€è€ƒè™‘å›¾åƒçš„è¾¹ç¼˜å°±å¯ä»¥ç†è§£å›¾åƒçš„å†…å®¹ã€‚

â€‹		è¾¹ç¼˜æ£€æµ‹çš„ç›®çš„æ˜¯åˆ¶ä½œä¸€ä¸ªçº¿å›¾ï¼Œåœ¨ä¸ä¼šæŸå®³ç†è§£å›¾åƒå†…å®¹çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶åˆå¤§å¤§å‡å°‘å›¾åƒçš„æ•°æ®é‡ï¼Œæä¾›äº†å¯¹å›¾åƒæ•°æ®çš„åˆé€‚æ¦‚è¿°ã€‚

æœ€ç®€å•çš„ç®—å­ï¼šRoberts

è‡ªå¸¦å¹³æ»‘çš„ä¸¤æ–¹å‘ç®—å­ï¼šPrewitt,Sobel ,Scharr

å„ä¸ªæ–¹å‘çš„ç®—å­ï¼šKirschï¼ŒRobinson

## 8.1 Roberts ç®—å­

### 8.1.1 åŸç†è¯¦è§£

Roberts è¾¹ç¼˜æ£€æµ‹æ˜¯å›¾åƒçŸ©é˜µä¸ä»¥ä¸‹ä¸¤ä¸ªå·ç§¯æ ¸ï¼š
$$
Roberts_{135}=\left[\begin{matrix}
1&0\\
0&-1
\end{matrix}\right]\\\\
Roberts_{45}=\left[\begin{matrix}
0&1\\
-1&0
\end{matrix}\right]
$$
â€‹		Robertsç®—å­**åˆ©ç”¨å¯¹è§’çº¿æ–¹å‘**ç›¸é‚»ä¸¤åƒç´ ä¹‹å·®è¿‘ä¼¼æ¢¯åº¦å¹…å€¼æ¥æ£€æµ‹è¾¹ç¼˜ï¼Œæ£€æµ‹å‚ç›´è¾¹ç¼˜çš„æ•ˆæœè¦ä¼˜äºå…¶ä»–æ–¹å‘è¾¹ç¼˜ï¼Œå®šä½ç²¾åº¦é«˜ï¼Œä½†å¯¹å™ªå£°çš„æŠ‘åˆ¶èƒ½åŠ›æ¯”è¾ƒè‹¥ï¼Œè¾¹ç¼˜æ£€æµ‹ç®—å­æ£€æŸ¥æ¯ä¸ªåƒç´ çš„é¢†åŸŸå¹¶å¯¹ç°åº¦å˜åŒ–äº†è¿›è¡Œ**é‡åŒ–**ï¼ŒåŒæ—¶ä¹ŸåŒ…å«**æ–¹å‘çš„ç¡®å®š**ã€‚



### 8.1.2 ä»£ç è¯¦è§£

```c++
void conv2D(InputArray _src, InputArray _kernel, OutputArray _dst, int ddepth, Point anchor = Point(-1, -1), int borderType = BORDER_DEFAULT);
```

â€‹		conv2Dä¸ºå·ç§¯å‡½æ•°ï¼Œå½“xâ‰ 0ï¼Œy=0æ—¶ï¼Œè®¡ç®—çš„æ˜¯å›¾åƒçŸ©é˜µä¸Roberts135æ ¸çš„å·ç§¯ï¼Œå½“x=0ï¼Œy=0æ—¶ï¼Œè®¡ç®—çš„æ˜¯å›¾åƒçŸ©é˜µä¸Roberts45æ ¸çš„å·ç§¯ã€‚

```c
/*roberts å·ç§¯*/
void roberts(InputArray src, OutputArray dst, int ddepth, int x, int y = 0, int borderType = BORDER_DEFAULT)
{
	CV_Assert(!(x == 0 && y == 0));
	Mat roberts_1 = (Mat_<float>(2, 2) << 1, 0, 0, -1);
	Mat roberts_2 = (Mat_<float>(2, 2) << 0, 1, -1, 0);
	//å½“ x ä¸ç­‰äºé›¶æ—¶ï¼Œsrc å’Œ roberts_1 å·ç§¯
	if (x != 0)
	{
		conv2D(src, roberts_1, dst, ddepth, Point(0, 0), borderType);
	}
	//å½“ y ä¸ç­‰äºé›¶æ—¶ï¼Œsrc å’Œ roberts_2 å·ç§¯
	if (y != 0)
	{
		conv2D(src, roberts_2, dst, ddepth, Point(0, 0), borderType);
	}
}
```



## 8.2 Prewittè¾¹ç¼˜æ£€æµ‹

### 8.2.1 Prewittç®—å­åŠåˆ†ç¦»æ€§

â€‹		æ ‡å‡†çš„Prewittè¾¹ç¼˜æ£€æµ‹ç®—å­ç”±ä»¥ä¸‹ä¸¤ä¸ªå·ç§¯æ ¸ï¼š
$$
Prewitt_{x}=\left[\begin{matrix}
1&0&-1\\
1&0&-1\\
1&0&-1
\end{matrix}\right]\\\\
Prewitt_{y}=\left[\begin{matrix}
1&1&1\\
0&0&0\\
-1&-1&-1
\end{matrix}\right]
$$
â€‹		å›¾åƒä¸Prewitt_xå·ç§¯åå¯ä»¥åæ˜ å›¾åƒå‚ç›´æ–¹å‘ä¸Šçš„è¾¹ç¼˜ï¼Œå›¾åƒä¸Prewitt_yå·ç§¯åå¯ä»¥åæ˜ å›¾åƒæ°´å¹³æ–¹å‘ä¸Šçš„è¾¹ç¼˜ï¼Œè€Œä¸”è¿™ä¸¤ç§è¾¹ç¼˜æ˜¯å¯ä»¥åˆ†ç¦»çš„ã€‚

â€‹		ç”±äºå¯¹å›¾åƒè¿›è¡Œäº†å¹³æ»‘å¤„ç†ï¼Œæ‰€ä»¥å¯¹å™ªå£°è¾ƒå¤šçš„å›¾åƒè¿›è¡ŒPrewittè¾¹ç¼˜æ£€æµ‹å¾—åˆ°çš„è¾¹ç¼˜æ¯”Robertsè¦å¥½ï¼Œå¯ä»¥å¯¹æ ‡å‡†çš„Prewittç®—å­è¿›è¡Œæ”¹è¿›ï¼Œæ¯”å¦‚ï¼š
$$
Prewitt_{135}=\left[\begin{matrix}
1&1&0\\
1&0&-1\\
0&-1&-1
\end{matrix}\right]\\\\
Prewitt_{45}=\left[\begin{matrix}
0&1&1\\
-1&0&1\\
-1&-1&0
\end{matrix}\right]
$$
â€‹		åæ˜ çš„æ˜¯åœ¨45Â°å’Œ135Â°æ–¹å‘ä¸Šçš„è¾¹ç¼˜ã€‚

### 8.2.2 ä»£ç è¯¦è§£



## 8.3 Sobelè¾¹ç¼˜æ£€æµ‹

### 8.3.1 Sobelç®—å­åŠåˆ†ç¦»æ€§

â€‹		å¯¹äºäºŒé¡¹å¼å±•å¼€å¼çš„ç³»æ•°ï¼Œå¯ä»¥ä½œä¸ºéå½’ä¸€åŒ–çš„é«˜æ–¯å¹³æ»‘ç®—å­ï¼Œåˆ©ç”¨n=2æ—¶å±•å¼€å¼çš„ç³»æ•°ï¼ŒæŠŠPrewittç®—å­ä¸­çš„éå½’ä¸€åŒ–çš„å‡å€¼å¹³æ»‘ç®—å­æ¢æˆè¯¥ç³»æ•°ï¼ŒæŠŠPrewittç®—å­ä¸­çš„éå½’ä¸€åŒ–çš„é„‚å‡å€¼å¹³æ»‘ç®—å­æ¢æˆè¯¥ç³»æ•°ï¼Œå³å¯å¾—åˆ°3é˜¶çš„Sobelè¾¹ç¼˜æ£€æµ‹ç®—å­ï¼š
$$
sobel_x=\left[\begin{matrix}
1&0&-1\\
2&0&-2\\
1&0&-1
\end{matrix}\right]\\\\
sobel_y=\left[\begin{matrix}
1&2&1\\
0&0&0\\
1&-2&-1
\end{matrix}\right]\\\\
$$
â€‹		ä¹Ÿå¯ä»¥åˆ©ç”¨äºŒé¡¹å¼å±•å¼€å¼çš„ç³»æ•°æ„å»ºçª—å£æ›´å¤§çš„Sobelç®—å­ï¼Œå¦‚5Ã—5ã€7Ã—7ã€‚

â€‹		ä¼˜ç‚¹ï¼šSobelç®—å­åœ¨è¿›è¡Œè¾¹ç¼˜æ£€æµ‹æ—¶**æ•ˆç‡è¾ƒé«˜**ï¼Œå½“å¯¹ç²¾åº¦è¦æ±‚ä¸æ˜¯å¾ˆé«˜æ—¶ï¼Œæ˜¯ä¸€ç§è¾ƒä¸ºå¸¸ç”¨çš„è¾¹ç¼˜æ£€æµ‹æ–¹æ³•ï¼›ç¼ºç‚¹ï¼šSobelç®—å­**å¯¹æ²¿xè½´å’Œyè½´çš„æ’åˆ—è¡¨ç¤ºå¾—è¾ƒå¥½**ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–è§’åº¦å¾—è¡¨ç¤ºå´ä¸å¤Ÿç²¾ç¡®

### 8.3.2 ä»£ç è¯¦è§£

```c++
Mat sobel(Mat image, int x_flag, int y_flag, int winSize, int borderType)
{
	// sobel å·ç§¯æ ¸çš„çª—å£å¤§å°ä¸ºå¤§äº 3 çš„å¥‡æ•° 
	CV_Assert(winSize >= 3 && winSize % 2 == 1);
	//å¹³æ»‘ç³»æ•°
	Mat pascalSmooth = getPascalSmooth(winSize);
	//å·®åˆ†ç³»æ•°
	Mat pascalDiff = getPascalDiff(winSize);
	Mat image_con_sobel;
	/* å½“ x_falg != 0 æ—¶ï¼Œè¿”å›å›¾åƒä¸æ°´å¹³æ–¹å‘çš„ Sobel æ ¸çš„å·ç§¯*/
	if (x_flag != 0)
	{
		//æ ¹æ®å¯åˆ†ç¦»å·ç§¯æ ¸çš„æ€§è´¨
		//å…ˆè¿›è¡Œä¸€ç»´å‚ç›´æ–¹å‘ä¸Šçš„å¹³æ»‘ï¼Œå†è¿›è¡Œä¸€ç»´æ°´å¹³æ–¹å‘çš„å·®åˆ†
		sepConv2D_Y_X(image, image_con_sobel, CV_32FC1, pascalSmooth.t(), pascalDiff, Point(-1, -1), borderType);
	}
	/* å½“ x_falg == 0 ä¸” y_flag != 0 æ—¶ï¼Œè¿”å›å›¾åƒä¸å‚ç›´ æ–¹å‘çš„ Sobel æ ¸çš„å·ç§¯*/
	if (x_flag == 0 && y_flag != 0)
	{
		//æ ¹æ®å¯åˆ†ç¦»å·ç§¯æ ¸çš„æ€§è´¨
		//å…ˆè¿›è¡Œä¸€ç»´æ°´å¹³æ–¹å‘ä¸Šçš„å¹³æ»‘ï¼Œå†è¿›è¡Œä¸€ç»´å‚ç›´æ–¹å‘çš„å·®åˆ†
		sepConv2D_X_Y(image, image_con_sobel, CV_32FC1, pascalSmooth, pascalDiff.t(), Point(-1, -1), borderType);
	}
	return image_con_sobel;
}
```



### 8.3.3 å¤„ç†ç»“æœ

â€‹																					å‚ç›´æ–¹å‘ä¸Šï¼š

![image-20231218141101462](E:\typora\Project\OpenCV4.assets\image-20231218141101462.png)

â€‹																				   æ°´å¹³æ–¹å‘ä¸Šï¼š

![image-20231218141200119](E:\typora\Project\OpenCV4.assets\image-20231218141200119.png)

â€‹																						è¾¹ç¼˜å›¾ï¼š

![image-20231218141237393](E:\typora\Project\OpenCV4.assets\image-20231218141237393.png)

## 8.4 Scharrç®—å­

### 8.4.1 åŸç†è¯¦è§£

â€‹		æ ‡å‡†çš„Scharrè¾¹ç¼˜æ£€æµ‹ç®—å­ä¸Prewittè¾¹ç¼˜æ£€æµ‹ç®—å­å’Œ3é˜¶çš„Sobelè¾¹ç¼˜æ£€æµ‹ç®—å­ç±»ä¼¼ï¼Œç”±ä»¥ä¸‹ä¸¤ä¸ªå·ç§¯æ ¸ï¼š
$$
scharr_x=\left[\begin{matrix}
3&0&-3\\
10&0&-10\\
3&0&-3
\end{matrix}\right]\\\\
scharr_y=\left[\begin{matrix}
3&10&3\\
3&0&-3\\
0&-3&-10
\end{matrix}\right]\\\\
$$
â€‹		è¿™ä¸¤ä¸ªå·ç§¯æ ¸éƒ½ä¸èƒ½åˆ†ç¦»ã€‚å›¾åƒä¸æ°´å¹³æ–¹å‘ä¸Šçš„scharr_xå·ç§¯ç»“æœåæ˜ çš„æ˜¯å‚ç›´æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦ï¼Œä¸å‚ç›´æ–¹å‘ä¸Šçš„scharr_yå·ç§¯ç»“æœåæ˜ çš„æ˜¯æ°´å¹³æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦ã€‚åŒæ ·Scharrè¾¹ç¼˜æ£€æµ‹ç®—å­ä¹Ÿå¯ä»¥æ‹“å±•åˆ°å…¶ä»–æ–¹å‘ï¼Œæ¯”å¦‚ï¼š
$$
scharr_{45}=\left[\begin{matrix}
0&3&10\\
-3&0&3\\
-10&-3&0
\end{matrix}\right]\\\\
scharr_{135}=\left[\begin{matrix}
10&3&0\\
3&0&-3\\
0&-3&-10
\end{matrix}\right]\\\\
$$

### 8.4.2 ä»£ç è¯¦è§£

### 8.4.3 å¤„ç†ç»“æœ

å‚ç›´æ–¹å‘ä¸Šçš„è¾¹ç¼˜ï¼š

![image-20231218143700328](E:\typora\Project\OpenCV4.assets\image-20231218143700328.png)

æ°´å¹³æ–¹å‘ä¸Šçš„è¾¹ç¼˜ï¼š

![image-20231218143716137](E:\typora\Project\OpenCV4.assets\image-20231218143716137.png)

è¾¹ç¼˜å¼ºåº¦ï¼š

![image-20231218143738586](E:\typora\Project\OpenCV4.assets\image-20231218143738586.png)

## 8.5 kirschå’ŒRobinsonç®—å­

### 8.5.1åŸç†è¯¦è§£

â€‹		1.Kirshç®—å­ç”±ä»¥ä¸‹8ä¸ªå·ç§¯æ ¸ç»„æˆ
$$
k_1=\left[\begin{matrix}
5&5&5\\
-3&0&-3\\
-3&-3&-3
\end{matrix}\right]\ 
k_2=\left[\begin{matrix}
-3&-3&-3\\
-3&0&-3\\
5&5&5
\end{matrix}\right]\
k_3=\left[\begin{matrix}
-3&5&5\\
-3&0&5\\
-3&-3&-3
\end{matrix}\right]\
k_4=\left[\begin{matrix}
-3&-3&-3\\
5&0&-3\\
5&5&-3
\end{matrix}\right]\\\\
k_5=\left[\begin{matrix}
-3&-3&5\\
-3&0&5\\
-3&-3&5
\end{matrix}\right]\
k_6=\left[\begin{matrix}
5&-3&-3\\
5&0&-3\\
5&-3&-3
\end{matrix}\right]\  
k_7=\left[\begin{matrix}
-3&-3&-3\\
-3&0&5\\
-3&5&5
\end{matrix}\right]\
k_8=\left[\begin{matrix}
5&5&-3\\
5&0&-3\\
-3&-3&-3
\end{matrix}\right]\\\\
$$
â€‹		å›¾åƒä¸æ¯ä¸€ä¸ªæ ¸è¿›è¡Œå·ç§¯ï¼Œç„¶åå–ç»å¯¹å€¼ä½œä¸ºå¯¹åº”æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦çš„é‡åŒ–ã€‚å¯¹8ä¸ªå·ç§¯ç»“æœå–ç»å¯¹å€¼ï¼Œç„¶åå†å¯¹åº”ä½ç½®å€¼å–æœ€å¤§å€¼ä½œä¸ºæœ€åè¾“å‡ºçš„è¾¹ç¼˜å¼ºåº¦ã€‚

â€‹		2.Robinsonè¾¹ç¼˜ç®—å­

â€‹		æš‚ç•¥

### 8.5.2 ä»£ç è¯¦è§£

```c++
/* Krisch è¾¹ç¼˜æ£€æµ‹ç®—æ³•*/
Mat krisch(InputArray src, int borderType = BORDER_DEFAULT)
{
	//å­˜å‚¨å…«ä¸ªå·ç§¯ç»“æœ
	vector<Mat> eightEdge;
	eightEdge.clear();
	/*ç¬¬1æ­¥ï¼šå›¾åƒçŸ©é˜µä¸8 ä¸ª å·ç§¯æ ¸å·ç§¯*/
	/*Krisch çš„ 8 ä¸ªå·ç§¯æ ¸å‡ä¸æ˜¯å¯åˆ†ç¦»çš„*/
	//å›¾åƒçŸ©é˜µä¸ k1 å·ç§¯
	Mat k1 = (Mat_<float>(3, 3) << 5, 5, 5, -3, 0, -3, -3, -3, -3);
	Mat src_k1;
	conv2D(src, k1, src_k1, CV_32FC1,Point(-1,-1), borderType);
	convertScaleAbs(src_k1, src_k1);
	eightEdge.push_back(src_k1);
	//å›¾åƒçŸ©é˜µä¸ k2 å·ç§¯
	Mat k2 = (Mat_<float>(3, 3) << -3, -3, -3, -3, 0, -3, 5, 5, 5);
	Mat src_k2;
	conv2D(src, k2, src_k2, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k2, src_k2);
	eightEdge.push_back(src_k2);
	//å›¾åƒçŸ©é˜µä¸ k3 å·ç§¯
	Mat k3 = (Mat_<float>(3, 3) << -3, 5, 5, -3, 0, 5, -3, -3, -3);
	Mat src_k3;
	conv2D(src, k3, src_k3, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k3, src_k3);
	eightEdge.push_back(src_k3);
	//å›¾åƒçŸ©é˜µä¸ k4 å·ç§¯
	Mat k4 = (Mat_<float>(3, 3) << -3, -3, -3, 5, 0, -3, 5, 5, -3);
	Mat src_k4;
	conv2D(src, k4, src_k4, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k4, src_k4);
	eightEdge.push_back(src_k4);
	//å›¾åƒçŸ©é˜µä¸ k5 å·ç§¯
	Mat k5 = (Mat_<float>(3, 3) << -3, -3, 5, -3, 0, 5, -3, -3, 5);
	Mat src_k5;
	conv2D(src, k5, src_k5, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k5, src_k5);
	eightEdge.push_back(src_k5);
	//å›¾åƒçŸ©é˜µä¸ k6 å·ç§¯
	Mat k6 = (Mat_<float>(3, 3) << 5, -3, -3, 5, 0, -3, 5, -3, -3);
	Mat src_k6;
	conv2D(src, k6, src_k6, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k6, src_k6);
	eightEdge.push_back(src_k6);
	//å›¾åƒçŸ©é˜µä¸ k7 å·ç§¯
	Mat k7 = (Mat_<float>(3, 3) << -3, -3, -3, -3, 0, 5, -3, 5, 5);
	Mat src_k7;
	conv2D(src, k7, src_k7, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k7, src_k7);
	eightEdge.push_back(src_k7);
	//å›¾åƒçŸ©é˜µä¸ k8 å·ç§¯
	Mat k8 = (Mat_<float>(3, 3) << 5, 5, -3, 5, 0, -3, -3, -3, -3);
	Mat src_k8;
	conv2D(src, k8, src_k8, CV_32FC1, Point(-1, -1), borderType);
	convertScaleAbs(src_k8, src_k8);
	eightEdge.push_back(src_k8);
	/*ç¬¬äºŒæ­¥ï¼šå°†æ±‚å¾—çš„å…«ä¸ªå·ç§¯ç»“æœ,å–å¯¹åº”ä½ç½®çš„æœ€å¤§å€¼ï¼Œä½œä¸ºæœ€åçš„è¾¹ç¼˜è¾“å‡º*/
	Mat krischEdge = eightEdge[0].clone();
	for (int i = 0; i < 8; i++)
	{
		max(krischEdge, eightEdge[i], krischEdge);
	}
	return krischEdge;
}
```

### 8.5.3 å¤„ç†ç»“æœ

![image-20231218160034325](E:\typora\Project\OpenCV4.assets\image-20231218160034325.png)

## 8.6 Cannyè¾¹ç¼˜æ£€æµ‹

### 8.6.1åŸç†è¯¦è§£

åŸºäºå·ç§¯è¿ç®—çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•ï¼Œæ¯”å¦‚Sobelã€Prewittç­‰ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š

(1)æ²¡æœ‰å……åˆ†åˆ©ç”¨è¾¹ç¼˜çš„æ¢¯åº¦æ–¹å‘ã€‚

(2)æœ€åè¾“å‡ºçš„è¾¹ç¼˜äºŒå€¼å›¾ï¼Œåªæ˜¯ç®€å•åœ°åˆ©ç”¨é˜ˆå€¼è¿›è¡Œç»´æŠ¤ï¼Œæ˜¾ç„¶å¦‚æœé˜ˆå€¼è¿‡å¤§ï¼Œåˆ™ä¼šæŸå¤±å¾ˆå¤šè¾¹ç¼˜ä¿¡æ¯ï¼›å¦‚æœé˜ˆå€¼è¿‡å°ï¼Œåˆ™ä¼šæœ‰å¾ˆå¤šå™ªéŸ³ã€‚

è€ŒCannyè¾¹ç¼˜æ£€æµ‹åŸºäºä¸¤ç‚¹åšäº†æ”¹è¿›ï¼Œæå‡ºäº†ï¼š

(1)åŸºäºè¾¹ç¼˜æ¢¯åº¦æ–¹å‘çš„éæå¤§å€¼æŠ‘åˆ¶ã€‚

(2)åŒé˜ˆå€¼çš„æ»åé˜ˆå€¼å¤„ç†ã€‚



#### **Cannyè¾¹ç¼˜æ£€æµ‹çš„è¿‘ä¼¼ç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼š**

1. å›¾åƒçŸ©é˜µåˆ†åˆ«ä¸æ°´å¹³æ–¹å‘ä¸Šçš„å·ç§¯æ ¸sobel_xå’Œå‚ç›´æ–¹å‘ä¸Šçš„å·ç§¯æ ¸sobel_yå·ç§¯å¾—åˆ°dxå’Œdy,ç„¶ååˆ©ç”¨å¹³æ–¹å’Œçš„å¼€æ–¹å¾—åˆ°è¾¹ç¼˜å¼ºåº¦ã€‚è¿™ä¸€æ­¥å’ŒSobelè¾¹ç¼˜æ£€æµ‹ä¸€æ ·ã€‚

2. åˆ©ç”¨ç¬¬ä¸€æ­¥è®¡ç®—å‡ºçš„dxå’Œdy,è®¡ç®—å‡ºæ¢¯åº¦æ–¹å‘angle=arctan2(dy,dx)ï¼Œå³å¯¹æ¯ä¸€ä¸ªä½ç½®ï¼ˆr,c),ç”¨æ¢¯åº¦è¡¨ç¤ºï¼Œä¸€èˆ¬ç”¨è§’åº¦çš„å½¢å¼è¡¨ç¤ºæ¢¯åº¦ã€‚

3. å¯¹æ¯ä¸€ä¸ªä½ç½®è¿›è¡Œ**éæå¤§å€¼æŠ‘åˆ¶**çš„å¤„ç†ï¼Œå®ƒèƒ½æ‰¾åˆ°å±€éƒ¨æå¤§å€¼ï¼Œå¹¶ç­›é™¤ï¼ˆæŠ‘åˆ¶ï¼‰é‚»åŸŸå†…å…¶ä½™çš„å€¼ï¼Œéæå¤§å€¼æŠ‘åˆ¶æ“ä½œè¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ªçŸ©é˜µã€‚

   åœ¨è·å¾—æ¢¯åº¦çš„æ–¹å‘å’Œå¤§å°ä¹‹åï¼Œåº”è¯¥å¯¹æ•´å¹…å›¾åƒåšä¸€ä¸ªæ‰«æï¼Œå»é™¤é‚£äº›éè¾¹ç•Œä¸Šçš„ç‚¹ã€‚å¯¹æ¯ä¸€ä¸ªåƒç´ è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹è¿™ä¸ªç‚¹çš„æ¢¯åº¦æ˜¯ä¸æ˜¯å‘¨å›´å…·æœ‰ç›¸åŒæ¢¯åº¦æ–¹å‘çš„ç‚¹ä¸­æœ€å¤§çš„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

   ![img](https://img-blog.csdn.net/20161118130215988)

â€‹		ä¸Šå›¾ä¸­çš„æ•°å­—ä»£è¡¨äº†åƒç´ ç‚¹çš„æ¢¯åº¦å¼ºåº¦ï¼Œç®­å¤´æ–¹å‘ä»£è¡¨äº†æ¢¯åº¦æ–¹å‘ã€‚ä»¥ç¬¬äºŒæ’ç¬¬ä¸‰ä¸ªåƒç´ ç‚¹ä¸ºä¾‹ï¼Œç”±äºæ¢¯åº¦æ–¹å‘å‘ä¸Šï¼Œåˆ™		å°†è¿™ä¸€ç‚¹çš„å¼ºåº¦[7]ä¸å…¶ä¸Šä¸‹ä¸¤ä¸ªåƒç´ ç‚¹çš„å¼ºåº¦[5å’Œ4]æ¯”è¾ƒï¼Œç”±äºè¿™ä¸€ç‚¹å¼ºåº¦æœ€å¤§ï¼Œåˆ™ä¿ç•™ã€‚

â€‹		å¯¹äºéæå¤§å€¼æŠ‘åˆ¶çš„å®ç°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š

â€‹		ç¬¬ä¸€ç§æ–¹æ³•ï¼šå°†æ¢¯åº¦æ–¹å‘ä¸€èˆ¬ç¦»æ•£åŒ–ä¸ºå››ç§æƒ…å†µã€‚0ã€90ã€45ã€135å››ä¸ªæ¢¯åº¦æ–¹å‘ä¸Šï¼Œå°†è¿‘ä¼¼çš„æ–¹å‘è¿‘ä¼¼ã€‚ä½†è¿™æ ·ä¼šèˆå¼ƒ		éƒ¨åˆ†ä¿¡æ¯ï¼Œä½¿å¾—å‡†ç¡®æ€§é™ä½ã€‚

â€‹		ç¬¬äºŒç§æ–¹æ³•ï¼šç”¨æ’å€¼æ³•æ‹Ÿåˆæ¢¯åº¦æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦ï¼Œè¿™æ ·ä¼šæ›´åŠ å‡†ç¡®åœ°è¡¡é‡æ¢¯åº¦æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦ã€‚

<img src="https://img-blog.csdnimg.cn/100afad86575453c93ce854df3c7958e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5pqW5LuU5Lya6aOe,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img" style="zoom: 47%;" />

â€‹		4.åŒé˜ˆå€¼çš„æ»åé˜ˆå€¼å¤„ç†ã€‚ç»è¿‡ç¬¬ä¸‰æ­¥éæå¤§å€¼æŠ‘åˆ¶å¤„ç†åçš„è¾¹ç¼˜å¼ºåº¦å›¾ï¼Œä¸€èˆ¬éœ€è¦é˜ˆå€¼åŒ–å¤„ç†ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯å…¨å±€é˜ˆå€¼		åˆ†å‰²å’Œå±€éƒ¨è‡ªé€‚åº”é˜ˆå€¼åˆ†å‰²ã€‚æ­¤å¤„ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œæ»åé˜ˆå€¼å¤„ç†ï¼Œå®ƒä½¿ç”¨ä¸¤ä¸ªé˜ˆå€¼â€”é«˜é˜ˆå€¼(upperThresh)å’Œä½é˜ˆå€¼		   		(lowerThresh),æŒ‰ç…§ä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™è¿›è¡Œè¾¹ç¼˜åŒ–çš„é˜ˆå€¼åŒ–å¤„ç†ã€‚

â€‹		(1)è¾¹ç¼˜å¼ºåº¦å¤§äºé«˜é˜ˆå€¼çš„é‚£äº›ç‚¹ä½œä¸ºç¡®å®šè¾¹ç¼˜ç‚¹ã€‚

â€‹		(2)è¾¹ç¼˜å¼ºåº¦æ¯”ä½é˜ˆå€¼å°çš„é‚£äº›ç‚¹ç«‹åˆ»å‰”é™¤ã€‚

â€‹		(3)é‚£äº›åœ¨é«˜é˜ˆå€¼ä¸ä½é˜ˆå€¼ä¹‹é—´çš„ç‚¹ï¼Œåªæœ‰é‚£äº›ç‚¹èƒ½å¤ŸæŒ‰ç…§ä¸€å®šè·¯å¾„ä¸ç¡®å®šè¾¹ç¼˜ç‚¹ç›¸è¿æ—¶ï¼Œæ‰èƒ½å¤Ÿä½œä¸ºè¾¹ç¼˜ç‚¹è¢«æ¥å—ã€‚ç»„æˆ		è¿™ä¸€è·¯å¾„çš„æ‰€æœ‰ç‚¹çš„è¾¹ç¼˜å¼ºåº¦éƒ½æ¯”ä½é˜ˆå€¼è¦å¤§ã€‚



### 8.6.2 ä»£ç è¯¦è§£

### 8.6.3 å¤„ç†ç»“æœ

â€‹											è¾¹ç¼˜å¼ºåº¦çš„ç°åº¦çº§æ˜¾ç¤º           	                        éæå¤§å€¼æŠ‘åˆ¶

<center class="half">    <img src="E:\typora\Project\OpenCV4.assets\image-20231218173919975.png" width="300"/>    <img src="E:\typora\Project\OpenCV4.assets\image-20231218173950041.png" width="300"/> </center>

â€‹												Cannyè¾¹ç¼˜                                               ä½é˜ˆå€¼å¤„ç†åçš„å›¾åƒ

<center class="half">    <img src="E:\typora\Project\OpenCV4.assets\image-20231218174019459.png" width="300"/>    <img src="E:\typora\Project\OpenCV4.assets\image-20231218174237515.png" width="300"/> </center>																	

â€‹																			é«˜é˜ˆå€¼å¤„ç†åçš„å›¾åƒ

![image-20231218174252400](E:\typora\Project\OpenCV4.assets\image-20231218174252400.png)

## 8.7 Laplacian ç®—å­

### 8.7.1 åŸç†è¯¦è§£

Laplaceç®—å­çš„ä¼˜ç‚¹ï¼šåªæœ‰ä¸€ä¸ªå·ç§¯æ ¸ï¼Œæ‰€//ä»¥å™¨è®¡ç®—æˆæœ¬æ¯”å…¶ä»–ç®—å­è¦ä½ã€‚

Laplaceç®—å­çš„ç¼ºç‚¹ï¼šå®ƒä¸åƒSobelå’ŒPrewittç®—å­é‚£æ ·å¯¹å›¾åƒè¿›è¡Œäº†å¹³æ»‘å¤„ç†ï¼Œæ‰€ä»¥å®ƒä¼šå¯¹å™ªå£°äº§ç”Ÿè¾ƒå¤§çš„å“åº”ï¼Œè¯¯å°†å™ªå£°å½“ä½œè¾¹ç¼˜ï¼Œå¹¶ä¸”å¾—ä¸åˆ°æœ‰æ–¹å‘çš„è¾¹ç¼˜ã€‚

![ä¸€äº›å¸¸ç”¨å½¢å¼](https://img-blog.csdnimg.cn/20200626225440359.png)

Laplaceæ ¸å†…çš„æ‰€æœ‰å€¼çš„å’Œå¿…é¡»ä¸º0ã€‚

### 8.7.2 ä»£ç è¯¦è§£

```c++
void laplacian(InputArray src, OutputArray dst, int ddepth, int borderType)
{
	Mat lapKernel = (Mat_<float>(3, 3) << 0, -1, 0, -1, 4, -1, 0, -1, 0);
	conv2D(src, lapKernel, dst, ddepth, Point(-1, -1), borderType);
}
```



### 8.7.3 å¤„ç†ç»“æœ

![image-20231218180732090](E:\typora\Project\OpenCV4.assets\image-20231218180732090.png)

## 8.8 é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯ï¼ˆLoGï¼‰è¾¹ç¼˜æ£€æµ‹

### 8.8.1 åŸç†è¯¦è§£

â€‹		åœ¨è¿ç”¨Lapalceæ ¸è¿›è¡Œè¾¹ç¼˜æ£€æµ‹çš„æ—¶å€™ï¼Œé¦–å…ˆè¦å¯¹å›¾åƒè¿›è¡Œé«˜æ–¯å¹³æ»‘å¤„ç†ï¼Œç„¶åå†ä¸Laplaceæ ¸è¿›è¡Œå·ç§¯è¿ç®—ã€‚è¿™é‡Œä½¿ç”¨äº†ä¸¤æ¬¡å·ç§¯è¿ç®—ã€‚å¦‚æœä½¿ç”¨äºŒç»´é«˜æ–¯å‡½æ•°ï¼Œå°±å¯ä»¥åªä½¿ç”¨ä¸€æ¬¡å·ç§¯è¿ç®—ã€‚

â€‹		å› ä¸ºè¿™ä¸¤ä¸ªå·ç§¯æ ¸éƒ½æ˜¯å¯¹å›¾ç‰‡äºŒé˜¶å¯¼æ•°çš„è¿‘ä¼¼ä¼°è®¡ï¼Œå®ƒä»¬å¯¹äºå›¾ç‰‡ä¸­çš„å™ªå£°å‡å¾ˆæ•æ„Ÿã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨è¿›è¡Œæ‹‰æ™®æ‹‰æ–¯æ“ä½œä¹‹å‰å…ˆå¯¹å›¾åƒè¿›è¡Œé«˜æ–¯å¹³æ»‘æ»¤æ³¢å¤„ç†ã€‚ ,å…ˆåˆ©ç”¨é«˜æ–¯å¹³æ»‘æ»¤æ³¢è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥é™ä½å›¾ç‰‡ä¸­çš„é«˜é¢‘å™ªå£°ï¼Œæ–¹ä¾¿åç»­çš„æ‹‰æ™®æ‹‰æ–¯æ“ä½œã€‚äº‹å®ä¸Šç”±äºå·ç§¯æ“ä½œå…·æœ‰ç»“åˆå¾‹ï¼Œå› æ­¤æˆ‘ä»¬å…ˆå°†é«˜æ–¯å¹³æ»‘æ»¤æ³¢å™¨ä¸æ‹‰æ™®æ‹‰æ–¯æ»¤æ³¢å™¨è¿›è¡Œå·ç§¯ï¼Œç„¶ååˆ©ç”¨å¾—åˆ°çš„æ··åˆæ»¤æ³¢å™¨å»å¯¹å›¾ç‰‡è¿›è¡Œå·ç§¯ä»¥å¾—åˆ°æ‰€éœ€çš„ç»“æœã€‚é‡‡ç”¨è¿™ä¸ªåšæ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹ï¼š

- ç”±äºé«˜æ–¯å’Œæ‹‰æ™®æ‹‰æ–¯æ ¸é€šå¸¸éƒ½æ¯”å›¾åƒå°å¾—å¤šï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•é€šå¸¸åªéœ€è¦å¾ˆå°‘çš„ç®—æœ¯è¿ç®—ã€‚
- LoG (' Laplacian of Gaussian')å†…æ ¸çš„å‚æ•°å¯ä»¥é¢„å…ˆè®¡ç®—ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶åªéœ€è¦å¯¹å›¾åƒæ‰§è¡Œä¸€éçš„å·ç§¯å³å¯ã€‚

### 8.8.2 ä»£ç è¯¦è§£

```c++
// LoG å·ç§¯
Mat LoG(InputArray image, float sigma, int win)
{
	Mat kernelX, kernelY;
	//å¾—åˆ°ä¸¤ä¸ªåˆ†ç¦»æ ¸
	getSepLoGKernel(sigma, win, kernelX, kernelY);
	//å…ˆæ°´å¹³å·ç§¯å†å‚ç›´å·ç§¯
	Mat covXY;
	sepConv2D_X_Y(image, covXY, CV_32FC1, kernelX, kernelY,Point(-1,-1),BORDER_DEFAULT);
	//å·ç§¯æ ¸è½¬ç½®
	Mat kernelX_T = kernelX.t();
	Mat kernelY_T = kernelY.t();
	//å…ˆå‚ç›´å·ç§¯å†æ°´å¹³å·ç§¯
	Mat covYX;
	sepConv2D_Y_X(image, covYX, CV_32FC1, kernelX_T, kernelY_T,Point(-1,-1), BORDER_DEFAULT);
	//è®¡ç®—ä¸¤ä¸ªå·ç§¯ç»“æœçš„å’Œï¼Œå¾—åˆ° LoG å·ç§¯
	Mat LoGCov;
	add(covXY, covYX, LoGCov);
	return LoGCov;
}
```

### 8.8.3 è¿è¡Œç»“æœ

![image-20231218192252983](E:\typora\Project\OpenCV4.assets\image-20231218192252983.png)

## 8.9 é«˜æ–¯å·®åˆ†ï¼ˆDoG)è¾¹ç¼˜æ£€æµ‹

### 8.9.1 é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯ä¸é«˜æ–¯å·®åˆ†çš„å…³ç³»



# ä¹ã€å‡ ä½•å½¢çŠ¶çš„æ£€æµ‹å’Œæ‹Ÿåˆ

é€šè¿‡é˜ˆå€¼åˆ†å‰²å¯ä»¥æå–å›¾åƒä¸­çš„ç›®æ ‡ç‰©ä½“ï¼Œé€šè¿‡è¾¹ç¼˜æ£€æµ‹å¯ä»¥æå–ç›®æ ‡ç‰©ä½“çš„è½®å»“ï¼Œä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•å¯ä»¥åŸºæœ¬ç¡®å®šç‰©ä½“çš„è¾¹ç¼˜æˆ–è€…å‰æ™¯ã€‚æ¥ä¸‹æ¥æ˜¯è¦æ‹Ÿåˆè¿™äº›è¾¹ç¼˜å’Œå‰æ™¯ï¼Œå¦‚ç¡®å®šè¾¹ç¼˜æ˜¯å¦æ»¡è¶³æŸç§å‡ ä½•å½¢çŠ¶ã€‚

## 9.1 ç‚¹é›†çš„æœ€å°å¤–åŒ…

â€‹		ç‚¹é›†æ˜¯æŒ‡åæ ‡ç‚¹çš„é›†ã€‚å·²ç»ç¬›å¡å°”åæ ‡ç³»ä¸­æœ‰å¾ˆå¤šåæ ‡ç‚¹ï¼Œéœ€è¦æ‰¾åˆ°èƒ½å¤ŸåŒ…å›´è¿™äº›åæ ‡ç‚¹çš„æœ€å°å¤–åŒ…å››è¾¹å½¢æˆ–è€…åœ†ï¼Œä»–ä»¬çš„é¢ç§¯å°±æ˜¯æœ€å°é¢ç§¯ã€‚

### 9.1.1 æœ€å°å¤–åŒ…æ—‹è½¬çŸ©å½¢

OpenCVæä¾›äº†æ—‹è½¬çŸ©å½¢çš„ç±»ï¼š

```c++
RotatedRect minAreaRect(InputArray points);
```

pointsï¼šæ¥æ”¶ä¸‰ç§ç‚¹é›†å½¢å¼

 ç¬¬ä¸€ç§ï¼šNÃ—2çš„Matç±»å‹ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç‚¹çš„åæ ‡ä¸”æ•°æ®ç±»å‹åªèƒ½æ˜¯ CV_32S æˆ–è€… CV_32Fï¼›

 ç¬¬äºŒç§ï¼švector<Point>æˆ–è€…vector<Point2f>ï¼Œå³å¤šä¸ªç‚¹ç»„æˆçš„å‘é‡ï¼›

 ç¬¬ä¸‰ç§ï¼šNÃ—1çš„åŒé€šé“Matç±»å‹

è¿”å›ï¼šè¾“å…¥ç‚¹é›†pointsçš„æœ€å°å¤–åŒ…æ—‹è½¬çŸ©å½¢ï¼ˆè§’åº¦ ä¸­å¿ƒ å°ºå¯¸ï¼‰

```C
//ç¬¬ä¸€ç§
Mat points = (Mat_<double>(5, 2) << 1, 1, 5, 1, 1, 10, 5, 10, 2, 5);
//ç¬¬äºŒç§
vector<Point2f> points;
points.push_back(Point2f(1, 1));
points.push_back(Point2f(5, 1));
points.push_back(Point2f(1, 10));
points.push_back(Point2f(5, 10));
points.push_back(Point2f(2, 5));
//ç¬¬ä¸‰ç§
Mat points = (Mat_<Vec2f>(5, 1) << Vec2f(1, 1), Vec2f(5, 1), Vec2f(1, 10), Vec2f(5, 10), Vec2f(2,5));
//è®¡ç®—ç‚¹é›†çš„æœ€å°å¤–åŒ…æ—‹è½¬çŸ©å½¢
RotatedRect rRect = minAreaRect(points);
Rect rect = boundingRect(points);
//æ‰“å°æ—‹è½¬çŸ©å½¢çš„ä¿¡æ¯:
cout << "æ—‹è½¬çŸ©å½¢çš„è§’åº¦:" << rRect.angle << endl;
cout << "æ—‹è½¬çŸ©å½¢çš„ä¸­å¿ƒ:" << rRect.center << endl;
cout << "æ—‹è½¬çŸ©å½¢çš„å°ºå¯¸:" << rRect.size << endl;
cout << rect << endl;
```

â€‹																è¾“å‡ºç»“æœä¸ºï¼š

![image-20231220101454298](E:\typora\Project\OpenCV4.assets\image-20231220101454298.png)



### 9.1.2 æ—‹è½¬çŸ©é˜µçš„4ä¸ªé¡¶ç‚¹

`RotatedRect`æä¾›çš„è¿”å›å€¼èƒ½å¤Ÿé—´æ¥è®¡ç®—å‡ºæ—‹è½¬çŸ©é˜µçš„å››ä¸ªé¡¶ç‚¹ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸ªå¯ä»¥ç›´æ¥è·å–å››ä¸ªé¡¶ç‚¹çš„å‡½æ•°ã€‚

```c
void boxPoints(RotatedRect box,OutputArray points)
```

- box:æ„é€ çš„RotatedRectç±»çŸ©å½¢
- points å­˜æ”¾å››ä¸ªé¡¶ç‚¹çš„Pointsé›†

```c++
RotatedRect rRect(Point2f(200, 200), Point2f(90, 150), -60);

	Mat vertices;
	boxPoints(rRect, vertices);

	cout << "é¡¶ç‚¹åæ ‡ï¼š" << endl;
	for (int i = 0; i < vertices.rows; i++)
	{
		Point2f point(vertices.at<float>(i, 0), vertices.at<float>(i, 1));
		cout << point << endl;
	}

	Mat img = Mat::zeros(Size(400, 400), CV_8UC1);
	for (int i = 0; i < 4; i++)
	{
		Point2f p1(vertices.at<float>(i, 0), vertices.at<float>(i, 1));
		int j = (i + 1) % 4;
		Point2f p2(vertices.at<float>(j, 0), vertices.at<float>(j, 1));
		line(img, p1, p2, Scalar(255), 3);
	}

	imshow("æ—‹è½¬çŸ©å½¢", img);
```

è¾“å‡ºç»“æœä¸ºï¼š

<img src="E:\typora\Project\OpenCV4.assets\image-20231220104557767.png" alt="image-20231220104557767" style="zoom:50%;" />

### 9.1.3 æœ€å°å¤–åŒ…åœ†

OpenCVä¸ºå®ç°æœ€å°å¤–åŒ…åœ†ï¼Œæä¾›äº†ä»¥ä¸‹å‡½æ•°ï¼š

```c
void cv::minEnclosingCircle(cv::InputArray points, cv::Point2f &center, float &radius)

```

- pointsï¼šç‚¹é›†ï¼ŒMat æˆ–è€… vector ç±»å‹ï¼Œå’Œ minAreaRect ä¸€æ ·
- centerï¼šæœ€å°å¤–åŒ…åœ†çš„åœ†å¿ƒï¼ˆè¾“å‡ºï¼‰
- radiusï¼šæœ€å°å¤–åŒ…åœ†çš„åŠå¾„ï¼ˆè¾“å‡ºï¼‰

```c
//ç‚¹é›†
Mat points = (Mat_<float>(5, 2) << 1, 1, 5, 1, 1, 10, 5, 10, 2, 5);
//è®¡ç®—ç‚¹é›†çš„æœ€å°å¤–åŒ…åœ†
Point2f center;	//åœ†å¿ƒ
float radius;	//åŠå¾„
minEnclosingCircle(points, center, radius);
//æ‰“å°æœ€å°å¤–åŒ…åœ†çš„ä¿¡æ¯:
cout << "åœ†å¿ƒ:" << center << endl;	//[3,5.5]
cout << "åŠå¾„:" << radius << endl;	//5.07216
```

è¾“å‡ºç»“æœ

![image-20231220105938408](E:\typora\Project\OpenCV4.assets\image-20231220105938408.png)

### 9.1.4 æœ€å°å¤–åŒ…ç›´ç«‹çŸ©å½¢

### 9.1.5 æœ€å°å‡¸åŒ…

ç»™å®šäºŒç»´å¹³é¢ä¸Šçš„ç‚¹é›†ï¼Œå‡¸åŒ…å°±æ˜¯å°†æœ€å¤–å±‚çš„ç‚¹è¿æ¥èµ·æ¥æ„æˆçš„å‡¸å¤šè¾¹å½¢ï¼Œä»–èƒ½åŒ…å«ç‚¹é›†ä¸­çš„æ‰€æœ‰ç‚¹

<img src="https://img-blog.csdnimg.cn/img_convert/34565da8517e5720655ef7309e1a124b.png" alt="image-20211020213356743" style="zoom: 50%;" />



OpenCVä¸ºæ±‚ç‚¹é›†çš„æœ€å°å‡¸åŒ…ï¼Œå®šä¹‰äº†å¦‚ä¸‹å‡½æ•°ï¼š

```c++
void cv::convexHull(cv::InputArray points, cv::OutputArray hull, bool clockwise = false, bool returnPoints = true)
```

- pointsï¼šè¾“å…¥ç‚¹é›†æ˜¯ vector æˆ–è€… Mat ç±»å‹

- hullï¼šæ„æˆå‡¸åŒ…çš„ç‚¹ï¼Œç±»å‹ä¸ºvector<Point>ã€vector<Point2f>

- clockwiseï¼šhull ä¸­çš„ç‚¹æ˜¯æŒ‰é¡ºæ—¶é’ˆè¿˜æ˜¯é€†æ—¶é’ˆæ’åˆ—çš„

- returnPointsï¼šå€¼ä¸º true æ—¶ï¼Œhull ä¸­å­˜å‚¨çš„æ˜¯åæ ‡ç‚¹ï¼›å€¼ä¸º false æ—¶ï¼Œå­˜å‚¨çš„æ˜¯è¿™äº›åæ ‡ç‚¹åœ¨ç‚¹é›†ä¸­çš„ç´¢å¼•

```c
//5è¡Œ2åˆ—çš„å•é€šé“Mat
Mat points = (Mat_<float>(5, 2) << 1, 1, 5, 1, 1, 10, 5, 10, 2, 5);
//æ±‚ç‚¹é›†çš„å‡¸åŒ…
vector<Point2f> hull;
convexHull(points, hull);
//æ‰“å°å¾—åˆ°æœ€å¤–ä¾§çš„ç‚¹ï¼ˆå‡¸åŒ…ï¼‰
for (int i = 0; i < hull.size(); i++)
{
	cout << hull[i] << ",";
}
```

### 9.1.6 æœ€å°å¤–åŒ…ä¸‰è§’å½¢

```c
double cv::minEnclosingTriangle(InputArray points, CV_OUT OutputArray triangle)
```

- points åªæ”¯æŒä¸¤ç§ç‚¹é›†å½¢å¼ï¼šğ‘ Ã— 1 çš„åŒé€šé“ Mat æˆ–è€…vector<Point>ã€vector<Point2f>ï¼Œä¸æ”¯æŒ ğ‘ Ã— 2 çš„å•é€šé“ Mat

- triangleï¼šæ˜¯è®¡ç®—å‡ºçš„ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œå­˜å‚¨åœ¨ vector å‘é‡ä¸­

- è¿”å›çš„ double å€¼æ˜¯æœ€å°å¤–åŒ…ä¸‰è§’å½¢çš„é¢ç§¯ã€‚

```c++
//5è¡Œ2åˆ—çš„å•é€šé“Mat
Mat points = (Mat_<int>(5, 2) << 1, 1, 5, 1, 1, 10, 5, 10, 2, 5);
//è½¬æ¢ä¸º5è¡Œ1åˆ—çš„åŒé€šé“Mat
points = points.reshape(2, 5);
//å­˜å‚¨ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹
vector<Point> triangle;
//ç‚¹é›†çš„æœ€å°å¤–åŒ…ä¸‰è§’å½¢
double area = minEnclosingTriangle(points, triangle);
cout << "ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹:";
for (int i = 0; i < 3; i++)
{
	cout << triangle[i] << ",";
}
cout << "æœ€å°å¤–åŒ…ä¸‰è§’å½¢çš„é¢ç§¯ï¼š" << area << endl;
//ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹: [9,1],[1,1],[1,19],
//æœ€å°å¤–åŒ…ä¸‰è§’å½¢çš„é¢ç§¯ï¼š72
```



## 9.2 éœå¤«ç›´çº¿æ£€æµ‹

### 9.2.1 åŸç†è¯¦è§£

â€‹		ç›´çº¿æ–¹ç¨‹å¯ç”±ä»¥ä¸‹æ–¹å¼è¡¨ç¤º
$$
Ï=xcosÎ¸+ysinÎ¸
$$
â€‹		å¦‚æœçŸ¥é“å¹³é¢å†…çš„ä¸€æ¡ç›´çº¿ï¼Œé‚£ä¹ˆå¯è®¡ç®—å‡ºå”¯ä¸€çš„Ï å’ŒÎ¸ ã€‚æ¢å¥è¯è®²ï¼Œxoyå¹³é¢å†…çš„ä»»æ„ä¸€æ¡ç›´çº¿å¯¹åº”å‚æ•°ç©ºé—´ï¼ˆä¹Ÿç§°éœå¤«ç©ºé—´ï¼‰Î¸oÏä¸­çš„ä¸€ç‚¹( Ï , Î¸ ) ã€‚

â€‹		Ïæ˜¯åŸç‚¹åˆ°ç›´çº¿çš„ä»£æ•°è·ç¦»ï¼ŒÎ¸æ˜¯ONä¸x è½´çš„æ­£æ–¹å‘ï¼ˆä¸€äºŒè±¡é™ï¼‰æˆ–è´Ÿæ–¹å‘ï¼ˆä¸‰å››è±¡é™ï¼‰çš„å¤¹è§’ã€‚
â€‹							<img src="https://img-blog.csdnimg.cn/img_convert/fa599de090d8dac24b3b48c901e4704f.png" alt="image-20211021190841904" style="zoom: 50%;" />

â€‹		å¦‚æœå·²çŸ¥xoyå¹³é¢å†…çš„ä¸€ä¸ªç‚¹ ( x_0 , y_0) (x_0,y_0)(x_0 ,y_0)ï¼Œåˆ™å¯¹åº”éœå¤«ç©ºé—´ä¸­çš„ä¸€æ¡æ›²çº¿Ï = x_0 cos_â¡Î¸ + y_0 sin â¡Î¸ + y_0 =x_0cosÎ¸+y0sinÎ¸ã€‚æ®æ­¤ï¼Œåœ¨xoyå¹³é¢å†…çš„å¤šä¸ªç‚¹åœ¨éœå¤«ç©ºé—´å†…å¯¹åº”å¤šæ¡æ›²çº¿ã€‚å¦‚æœè¿™å‡ æ¡æ›²çº¿ç›¸äº¤äºåŒä¸€ç‚¹ï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªç‚¹åœ¨xoy å¹³é¢å†…å°±æ˜¯å…±çº¿çš„ã€‚

â€‹		**è¿™å°±æ˜¯éœå¤«çº¿å˜æ¢è¦åšçš„ï¼š**å®ƒè¿½è¸ªå›¾åƒä¸­æ¯ä¸ªç‚¹å¯¹åº”æ›²çº¿é—´çš„äº¤ç‚¹. å¦‚æœäº¤äºä¸€ç‚¹çš„æ›²çº¿çš„æ•°é‡è¶…è¿‡äº†é˜ˆå€¼, é‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªäº¤ç‚¹æ‰€ä»£è¡¨çš„å‚æ•°è¡¨ç¤ºçš„ç›´çº¿ï¼Œåœ¨åŸå›¾åƒä¸­ä¸ºä¸€æ¡ç›´çº¿ã€‚

### 9.2.2 ä»£ç è¯¦è§£

â€‹		OpenCVæä¾›çš„éœå¤«ç›´çº¿æ£€æµ‹å‡½æ•°å¦‚ä¸‹ï¼š

```c
void cv::HoughLines(cv::InputArray image, cv::OutputArray lines, double rho, double theta, int threshold, double srn = (0.0), double stn = (0.0), double min_theta = (0.0), double max_theta = (3.141592653589793116))
```

- imageï¼šè¾“å…¥è¾¹ç¼˜å›¾ç‰‡ï¼Œå¿…é¡»æ˜¯å•é€šé“çš„Matæ ¼å¼çš„äºŒå€¼å›¾åƒ

- linesï¼švector<Vec2f>æ ¼å¼ï¼ŒåŒ…å«Ï \rhoÏå’ŒÎ¸ \thetaÎ¸ä¿¡æ¯ï¼Œä¸åŒ…å«ç›´çº¿ä¸Šçš„ç‚¹

- rhoï¼šä»¥åƒç´ ä¸ºå•ä½çš„è·ç¦» r çš„ç²¾åº¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ç²¾åº¦æ˜¯ 1

- thetaï¼šè§’åº¦ Î¸ çš„ç²¾åº¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ç²¾åº¦æ˜¯CV_PI / 180ï¼Œè¡¨ç¤ºè¦æœç´¢æ‰€æœ‰å¯èƒ½çš„è§’åº¦

- thresholdï¼šé˜ˆå€¼ã€‚é˜ˆå€¼è¶Šå¤§ -> æ£€æµ‹è¶Šç²¾å‡† + é€Ÿåº¦è¶Šå¿« + ç›´çº¿è¶Šå°‘

æ ‡å‡†çš„éœå¤«ç›´çº¿æ£€æµ‹å†…å­˜æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œæ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼ŒåŸºäºè¿™ä¸€ç‚¹ï¼Œæå‡ºäº†æ¦‚ç‡éœå¤«ç›´çº¿æ£€æµ‹ï¼Œå®ƒéšæœºåœ°ä»è¾¹ç¼˜äºŒå€¼å›¾ä¸­é€‰æ‹©å‰æ™¯åƒç´ ç‚¹ï¼Œç¡®å®šæ£€æµ‹ç›´çº¿çš„ä¸¤ä¸ªå‚æ•°ï¼Œå…¶æœ¬è´¨ä¸Šè¿˜æ˜¯æ ‡å‡†çš„éœå¤«ç›´çº¿æ£€æµ‹ã€‚

```c++
void cv::HoughLinesP(InputArray 	image,
                    OutputArray 	lines,
                    double 			rho,
                    double 			theta,
                    int 			threshold,
                    double 			minLineLength = 0,
                    double 			maxLineGap = 0 
                    )		
```

- imageï¼šè¾“å…¥è¾¹ç¼˜å›¾ç‰‡ï¼Œå¿…é¡»æ˜¯å•é€šé“çš„Matæ ¼å¼çš„äºŒå€¼å›¾åƒã€‚
- linesï¼švector<Vec2f>æ ¼å¼ï¼ŒåŒ…å«Ï \rhoÏå’ŒÎ¸ \thetaÎ¸ä¿¡æ¯ï¼Œä¸åŒ…å«ç›´çº¿ä¸Šçš„ç‚¹ã€‚
- rhoï¼šä»¥åƒç´ ä¸ºå•ä½çš„è·ç¦» r çš„ç²¾åº¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ç²¾åº¦æ˜¯ 1ã€‚
- thetaï¼šè§’åº¦ Î¸ çš„ç²¾åº¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ç²¾åº¦æ˜¯CV_PI / 180ï¼Œè¡¨ç¤ºè¦æœç´¢æ‰€æœ‰å¯èƒ½çš„è§’åº¦ã€‚
- thresholdï¼šé˜ˆå€¼ã€‚é˜ˆå€¼è¶Šå¤§ -> æ£€æµ‹è¶Šç²¾å‡† + é€Ÿåº¦è¶Šå¿« + ç›´çº¿è¶Šå°‘ã€‚
- minLineLengthï¼šæœ€å°çº¿é•¿ã€‚ çŸ­äºæ­¤é•¿åº¦çš„å°†è¢«æ‹’ç»ã€‚
- maxLineGapï¼šè¿æ¥åŒä¸€æ¡çº¿ä¸Šçš„ç‚¹ä¹‹é—´çš„æœ€å¤§å…è®¸é—´éš™ã€‚

```c++
void on_HoughLines(int, void*)
{
    // 0ã€ç”Ÿæˆç°åº¦å›¾
    cvtColor(g_midImage, g_srcGrayImage, COLOR_GRAY2BGR);//è½¬åŒ–è¾¹ç¼˜æ£€æµ‹åçš„å›¾ä¸ºç°åº¦å›¾
    // 1ã€å®šä¹‰ä¸€ä¸ªçŸ¢é‡ç»“æ„linesç”¨äºå­˜æ”¾å¾—åˆ°çš„çº¿æ®µçŸ¢é‡é›†åˆ
    // 2ã€è¿›è¡Œéœå¤«çº¿å˜æ¢
    // 3ã€ä¾æ¬¡åœ¨å›¾ä¸­ç»˜åˆ¶å‡ºæ¯æ¡çº¿æ®µ
    vector<Vec4i> lines;
    HoughLinesP(g_midImage, lines, 1, CV_PI / 180, g_HoughLinesThreshold, g_minLineLength, 10);
    for (size_t i = 0; i < lines.size(); i++)
    {
        Vec4i l = lines[i];
        line(g_srcGrayImage, Point(l[0], l[1]), Point(l[2], l[3]), Scalar(186, 88, 255), 1, LINE_AA);
    }
    //æ˜¾ç¤ºæ•ˆæœå›¾
    imshow("HoughLines", g_srcGrayImage);
}
```

```c++
 // 1ã€è½½å…¥åŸå›¾
	g_srcImage = imread("F:\\Visuo studio\\Project\\Opencv\\Photo\\3.png");
	if (!g_srcImage.data) { printf("Ohï¼Œnoï¼Œè¯»å–srcImageé”™è¯¯~ï¼ \n"); return false; }

	//æ˜¾ç¤ºåŸå§‹å›¾
	imshow("ã€åŸå§‹å›¾ã€‘", g_srcImage);

	// 2ã€è¿›è¡Œè¾¹ç¼˜æ£€æµ‹å’Œè½¬åŒ–ä¸ºç°åº¦å›¾
	Canny(g_srcImage, g_midImage, 50, 200, 3);//è¿›è¡Œä¸€æ­¤cannyè¾¹ç¼˜æ£€æµ‹
	imshow("ã€è¾¹ç¼˜æ£€æµ‹åçš„å›¾ã€‘", g_midImage);

	// 3ã€åˆ›å»ºtrackbar
	namedWindow("HoughLines", WINDOW_AUTOSIZE);
	createTrackbar("ç´¯åŠ é˜ˆå€¼ï¼š", "HoughLines", &g_HoughLinesThreshold, 300, on_HoughLines);
	createTrackbar("æœ€å°ç›´çº¿è·ç¦»ï¼š", "HoughLines", &g_minLineLength, 200, on_HoughLines);

	// 4ã€è°ƒç”¨å›è°ƒå‡½æ•°
	on_HoughLines(0, 0);

	//è½®è¯¢è·å–æŒ‰é”®ä¿¡æ¯ï¼Œè‹¥æŒ‰ä¸‹Qï¼Œç¨‹åºé€€å‡º
	while ((char(waitKey(1)) != 'q')) {}

	waitKey(0);
	return 0;
```



### 9.2.3 è¾“å‡ºç»“æœ



![image-20231220132334373](E:\typora\Project\OpenCV4.assets\image-20231220132334373.png)

éšç€ç´¯åŠ é˜ˆå€¼çš„å‡å°‘ï¼Œè¢«è¯†åˆ«ä¸ºç›´çº¿çš„çº¿æ®µå¢åŠ ã€‚

<center class="half">    <img src="E:\typora\Project\OpenCV4.assets\image-20231220134028892.png" width="400"/>    <img src="E:\typora\Project\OpenCV4.assets\image-20231220134122784.png" width="400"/> </center>		



## 9.3 éœå¤«åœ†æ£€æµ‹

### 9.3.1 åŸç†è¯¦è§£

å¯¹äºåŠå¾„å·²çŸ¥çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ç”»åœ†æ±‚äº¤ç‚¹çš„æ–¹å¼å¯»æ‰¾åœ†å¿ƒï¼Œä½†å¯¹äºåŠå¾„æœªçŸ¥çš„æƒ…å†µï¼Œéœ€è¦å¼•å…¥æ–°çš„å˜é‡

![img](https://img-blog.csdnimg.cn/20210225231811918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM4MDA3Njk1,size_16,color_FFFFFF,t_70#pic_center)

æˆ‘ä»¬å¼•å…¥ä¸‰ç»´çš„å˜é‡r,å¯¹åº”ä»»ä½•ä¸€ä¸ªç‚¹ï¼Œå¯¹åº”åˆ°abrç©ºé—´ä¸­çš„é”¥é¢
$$
r^2=(a-x_i)^2+(b-y_i)^2
$$
å¦‚æœå¤šä¸ªé”¥é¢ç›¸äº¤äºä¸€ç‚¹ï¼ˆa1,b1,r1),åˆ™å¯¹åº”åœ¨xoyå¹³é¢å†…çš„æ˜¯å…±åœ†çš„ï¼Œä¸”åœ†å¿ƒä¸º(a1,b1)ï¼ŒåŠå¾„ä¸ºr1ã€‚ä½†è¿™æ ·çš„ç¨‹åºè¿è¡Œæ•ˆç‡å¾ˆä½ï¼Œé€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚ä¸€èˆ¬é€šè¿‡â€œéœå¤«æ¢¯åº¦æ³•â€çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**éœå¤«æ¢¯åº¦æ³•:**

1. é¦–å…ˆå¯¹å›¾åƒåº”ç”¨è¾¹ç¼˜æ£€æµ‹ï¼Œæ¯”å¦‚ç”¨cannyè¾¹ç¼˜æ£€æµ‹ã€‚
2. ç„¶åï¼Œå¯¹è¾¹ç¼˜å›¾åƒä¸­çš„æ¯ä¸€ä¸ªéé›¶ç‚¹ï¼Œè€ƒè™‘å…¶å±€éƒ¨æ¢¯åº¦ï¼Œå³ç”¨Sobelï¼ˆï¼‰å‡½æ•°è®¡ç®—xå’Œyæ–¹å‘çš„Sobelä¸€é˜¶å¯¼æ•°å¾—åˆ°æ¢¯åº¦ã€‚
3. åˆ©ç”¨å¾—åˆ°çš„æ¢¯åº¦ï¼Œç”±æ–œç‡æŒ‡å®šçš„ç›´çº¿ä¸Šçš„æ¯ä¸€ä¸ªç‚¹éƒ½åœ¨ç´¯åŠ å™¨ä¸­è¢«ç´¯åŠ ï¼Œè¿™é‡Œçš„æ–œç‡æ˜¯ä»ä¸€ä¸ªæŒ‡å®šçš„æœ€å°å€¼åˆ°æŒ‡å®šçš„æœ€å¤§å€¼çš„è·ç¦»ã€‚
4. åŒæ—¶ï¼Œæ ‡è®°è¾¹ç¼˜å›¾åƒä¸­æ¯ä¸€ä¸ªé0åƒç´ çš„ä½ç½®ã€‚
5. ç„¶åä»äºŒç»´ç´¯åŠ å™¨ä¸­è¿™äº›ç‚¹ä¸­é€‰æ‹©å€™é€‰çš„ä¸­å¿ƒï¼Œè¿™äº›ä¸­å¿ƒéƒ½å¤§äºç»™å®šé˜ˆå€¼å¹¶ä¸”å¤§äºå…¶æ‰€æœ‰è¿‘é‚»ã€‚è¿™äº›å€™é€‰çš„ä¸­å¿ƒæŒ‰ç…§ç´¯åŠ å€¼é™åºæ’åˆ—ï¼Œä»¥ä¾¿äºæœ€æ”¯æŒåƒç´ çš„ä¸­å¿ƒé¦–å…ˆå‡ºç°ã€‚
6. æ¥ä¸‹æ¥å¯¹æ¯ä¸€ä¸ªä¸­å¿ƒï¼Œè€ƒè™‘æ‰€æœ‰çš„é0åƒç´ ã€‚
7. è¿™äº›åƒç´ æŒ‰ç…§å…¶ä¸ä¸­å¿ƒçš„è·ç¦»æ’åºã€‚ä»åˆ°æœ€å¤§åŠå¾„çš„æœ€å°è·ç¦»ç®—èµ·ï¼Œé€‰æ‹©é0åƒç´ æœ€æ”¯æŒçš„ä¸€æ¡åŠå¾„ã€‚8.å¦‚æœä¸€ä¸ªä¸­å¿ƒæ”¶åˆ°è¾¹ç¼˜å›¾åƒé0åƒç´ æœ€å……åˆ†çš„æ”¯æŒï¼Œå¹¶ä¸”åˆ°å‰æœŸè¢«é€‰æ‹©çš„ä¸­å¿ƒæœ‰è¶³å¤Ÿçš„è·ç¦»ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚

### 9.3.2 ä»£ç è¯¦è§£

```c++
C++: void HoughCircles(
InputArray image,				// å³æºå›¾åƒï¼Œéœ€ä¸º8ä½çš„ç°åº¦å•é€šé“å›¾åƒã€‚
OutputArray circles, 			// å­˜å‚¨äº†æ£€æµ‹åˆ°çš„åœ†çš„è¾“å‡ºçŸ¢é‡ï¼Œæ¯ä¸ªçŸ¢é‡ç”±åŒ…å«äº†3ä¸ªå…ƒç´ çš„æµ®ç‚¹çŸ¢é‡(x, y, radius)è¡¨ç¤º
int method, 					// å³ä½¿ç”¨çš„æ£€æµ‹æ–¹æ³•ï¼Œç›®å‰OpenCVä¸­å°±éœå¤«æ¢¯åº¦æ³•ä¸€ç§å¯ä»¥ä½¿ç”¨ï¼Œå®ƒçš„æ ‡è¯†ç¬¦ä¸ºCV_HOUGH_GRADIENT
double dp, 						// ç”¨æ¥æ£€æµ‹åœ†å¿ƒçš„ç´¯åŠ å™¨å›¾åƒçš„åˆ†è¾¨ç‡äºè¾“å…¥å›¾åƒä¹‹æ¯”çš„å€’æ•°ï¼Œä¸”æ­¤å‚æ•°å…è®¸åˆ›å»ºä¸€ä¸ªæ¯”è¾“å…¥å›¾åƒåˆ†è¾¨ç‡ä½çš„ç´¯åŠ å™¨ã€‚
double minDist, 				// ä¸ºéœå¤«å˜æ¢æ£€æµ‹åˆ°çš„åœ†çš„åœ†å¿ƒä¹‹é—´çš„æœ€å°è·ç¦»ï¼Œå³è®©æˆ‘ä»¬çš„ç®—æ³•èƒ½æ˜æ˜¾åŒºåˆ†çš„ä¸¤ä¸ªä¸åŒåœ†ä¹‹é—´çš„æœ€å°è·ç¦»ã€‚
double param1=100,				// å®ƒæ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°methodè®¾ç½®çš„æ£€æµ‹æ–¹æ³•çš„å¯¹åº”çš„å‚æ•°ã€‚å¯¹å½“å‰å”¯ä¸€çš„æ–¹æ³•éœå¤«æ¢¯åº¦æ³•CV_HOUGH_GRADIENTï¼Œå®ƒè¡¨ç¤ºä¼ é€’ç»™cannyè¾¹ç¼˜æ£€æµ‹ç®—å­çš„é«˜é˜ˆå€¼ï¼Œè€Œä½é˜ˆå€¼ä¸ºé«˜é˜ˆå€¼çš„ä¸€åŠã€‚
double param2=100, 				// å®ƒæ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°methodè®¾ç½®çš„æ£€æµ‹æ–¹æ³•çš„å¯¹åº”çš„å‚æ•°ã€‚å¯¹å½“å‰å”¯ä¸€çš„æ–¹æ³•éœå¤«æ¢¯åº¦æ³•CV_HOUGH_GRADIENTï¼Œå®ƒè¡¨ç¤ºåœ¨æ£€æµ‹é˜¶æ®µåœ†å¿ƒçš„ç´¯åŠ å™¨é˜ˆå€¼ã€‚å®ƒè¶Šå°çš„è¯ï¼Œå°±å¯ä»¥æ£€æµ‹åˆ°æ›´å¤šæ ¹æœ¬ä¸å­˜åœ¨çš„åœ†ï¼Œè€Œå®ƒè¶Šå¤§çš„è¯ï¼Œèƒ½é€šè¿‡æ£€æµ‹çš„åœ†å°±æ›´åŠ æ¥è¿‘å®Œç¾çš„åœ†å½¢äº†ã€‚
int minRadius=0, 				// è¡¨ç¤ºåœ†åŠå¾„çš„æœ€å°å€¼
int maxRadius=0 				// è¡¨ç¤ºåœ†åŠå¾„çš„æœ€å¤§å€¼
)

```

```c++
    // 1ã€è½½å…¥åŸå§‹å›¾ã€Matå˜é‡å®šä¹‰
    Mat srcImage = imread("F:/C++/2. OPENCV 3.1.0/7.2 Hough éœå¤«å˜æ¢/2.jpg");  //å·¥ç¨‹ç›®å½•ä¸‹åº”è¯¥æœ‰ä¸€å¼ åä¸º1.jpgçš„ç´ æå›¾
    Mat midImage,dstImage;//ä¸´æ—¶å˜é‡å’Œç›®æ ‡å›¾çš„å®šä¹‰

    // 2ã€æ˜¾ç¤ºåŸå§‹å›¾
    imshow("ã€åŸå§‹å›¾ã€‘", srcImage);

    // 3ã€è½¬ä¸ºç°åº¦å›¾å¹¶è¿›è¡Œå›¾åƒå¹³æ»‘
    cvtColor(srcImage,midImage, COLOR_BGR2GRAY);//è½¬åŒ–è¾¹ç¼˜æ£€æµ‹åçš„å›¾ä¸ºç°åº¦å›¾
    GaussianBlur( midImage, midImage, Size(9, 9), 2, 2 );

    // 4ã€è¿›è¡Œéœå¤«åœ†å˜æ¢
    vector<Vec3f> circles;
    //HoughCircles( midImage, circles, HOUGH_GRADIENT,1.5, 10, 200, 100, 0, 0 );
    HoughCircles( midImage, circles, HOUGH_GRADIENT,1.5, 5, 200, 50, 0, 0 );
    // 5ã€ä¾æ¬¡åœ¨å›¾ä¸­ç»˜åˆ¶å‡ºåœ†
    for( size_t i = 0; i < circles.size(); i++ )
    {
        //å‚æ•°å®šä¹‰
        Point center(cvRound(circles[i][0]), cvRound(circles[i][1]));
        int radius = cvRound(circles[i][2]);
        //ç»˜åˆ¶åœ†å¿ƒ
        circle( srcImage, center, 3, Scalar(0,255,0), -1, 8, 0 ); // å¡«æ»¡
        //ç»˜åˆ¶åœ†è½®å»“
        circle( srcImage, center, radius, Scalar(155,50,255), 2, 8, 0 );
    }

    //6ã€æ˜¾ç¤ºæ•ˆæœå›¾
    imshow("ã€æ•ˆæœå›¾ã€‘", srcImage);

```

### 9.3.3 è¾“å‡ºç»“æœ

param2=100æ—¶

![image-20231220145348905](E:\typora\Project\OpenCV4.assets\image-20231220145348905.png)

param2=50æ—¶ï¼Œäº§ç”Ÿäº†å¾ˆå¤šä¸å­˜åœ¨çš„åœ†

![image-20231220145532278](E:\typora\Project\OpenCV4.assets\image-20231220145532278.png)

param2=200æ—¶ï¼Œäº§ç”Ÿçš„åœ†è´¨é‡å¾ˆå¥½

![image-20231220145645912](E:\typora\Project\OpenCV4.assets\image-20231220145645912.png)





## 9.4 è½®å»“

### 9.4.1 æŸ¥æ‰¾ã€ç»˜åˆ¶è½®å»“

ä¹‹å‰çš„ç‚¹é›†æ˜¯æ‰‹åŠ¨è¾“å…¥æˆ–è€…éšæœºç”Ÿæˆçš„ï¼ŒOpenCVæä¾›äº†ä¸€ä¸ªå¯ä»¥è¿”å›ä¸€ä¸ªæœ‰åºçš„ç‚¹é›†çš„æ–¹æ³•

```c++
void findContours(InputOutputArray image, OutputArrayOfArrays contours, OutputArray hierarchy, int mode, int method, Point offset=Point());	
```

- `image`   è¦ç»˜åˆ¶è½®å»“çš„å›¾åƒ,8ä½å•é€šé“çš„å›¾åƒï¼ˆ256çº§ç°åº¦å›¾ï¼‰
- `contours`  æ‰€æœ‰è¾“å…¥çš„è½®å»“ï¼Œæ‰¾åˆ°çš„è½®å»“ï¼Œå…¶ä¸­æ¯ä¸ªè½®å»“ä¼šè¢«å­˜å‚¨ä¸ºvector<Point>
- `hierachy`  å±‚æ¬¡ç»“æ„ï¼Œå¯é€‰çš„è¾“å‡ºå‘é‡ï¼ŒåŒ…å«å…³äºå›¾åƒçš„æ‹“æ‰‘ç»“æ„ä¿¡æ¯,å…¶å…·æœ‰è·Ÿè½®å»“æ•°ç›¸åŒçš„å…ƒç´ ä¸ªæ•°,ç±»å‹ä¸ºvector<Vec4i>ï¼Œåä¸€ä¸ªè½®å»“ã€å‰ä¸€ä¸ªè½®å»“ã€ç¬¬ä¸€ä¸ªå­è½®å»“ã€çˆ¶è½®å»“çš„ç´¢å¼•ç¼–å·ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”é¡¹ï¼Œè¯¥å€¼è®¾ç½®ä¸º-1
- `mode`  æ£€ç´¢è½®å»“çš„æ¨¡å¼åˆ†åˆ«è¡¨ç¤º
- `method`  ä¸ºè½®å»“çš„è¿‘ä¼¼åŠæ³•
- `offset`  ä»£è¡¨è½®å»“ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºä»»æ„å€¼

**mode:**

| RETR_EXTERNAL è¡¨ç¤ºåªæ£€æµ‹å¤–è½®å»“                               |
| :----------------------------------------------------------- |
| RETR_LIST æ£€æµ‹çš„è½®å»“ä¸å»ºç«‹ç­‰çº§å…³ç³»                           |
| RETR_CCOMP å»ºç«‹ä¸¤ä¸ªç­‰çº§çš„è½®å»“ï¼Œä¸Šé¢çš„ä¸€å±‚ä¸ºå¤–è¾¹ç•Œï¼Œé‡Œé¢çš„ä¸€å±‚ä¸ºå†…å­”çš„è¾¹ ç•Œä¿¡æ¯ã€‚  å¦‚æœå†…å­”å†…è¿˜æœ‰ä¸€ä¸ªè¿é€šç‰©ä½“ï¼Œè¿™ä¸ªç‰©ä½“çš„è¾¹ç•Œä¹Ÿåœ¨é¡¶å±‚ã€‚ |
| RETR_TREE å»ºç«‹ä¸€ä¸ªç­‰çº§æ ‘ç»“æ„çš„è½®å»“ã€‚å…·ä½“å‚è€ƒcontours.cè¿™ä¸ªdemo |

**method:**

| CHAIN_APPROX_NONE å­˜å‚¨æ‰€æœ‰çš„è½®å»“ç‚¹ï¼Œç›¸é‚»çš„ä¸¤ä¸ªç‚¹çš„åƒç´ ä½ç½®å·®ä¸è¶…è¿‡1ï¼Œå³maxï¼ˆabsï¼ˆx1-x2ï¼‰ï¼Œabsï¼ˆy2-y1ï¼‰ï¼‰==1 |
| ------------------------------------------------------------ |
| CHAIN_APPROX_SIMPLE å‹ç¼©æ°´å¹³æ–¹å‘ï¼Œå‚ç›´æ–¹å‘ï¼Œå¯¹è§’çº¿æ–¹å‘çš„å…ƒç´ ï¼Œåªä¿ç•™è¯¥æ–¹å‘çš„ç»ˆç‚¹åæ ‡ï¼Œä¾‹å¦‚ä¸€ä¸ªçŸ©å½¢è½®å»“åªéœ€4ä¸ªç‚¹æ¥ä¿å­˜è½®å»“ä¿¡æ¯ |
| CHAIN_APPROX_TC89_L1ï¼ŒCV_CHAIN_APPROX_TC89_KCOS ä½¿ç”¨teh-Chinl chain è¿‘ä¼¼ç®—æ³• |

ä¸ºäº†ç›´è§‚åœ°ç†è§£æ‰€æ‰¾åˆ°çš„è½®å»“ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°ï¼š

```c
void drawContours(
InputOutputArray image, 		// è¦ç»˜åˆ¶è½®å»“çš„å›¾åƒ
InputArrayOfArrays contours, 	// æ‰€æœ‰è¾“å…¥çš„è½®å»“ï¼Œæ¯ä¸ªè½®å»“è¢«ä¿å­˜æˆä¸€ä¸ªpointå‘é‡(vector<vector<Point>>)
int contourIdx, 				// æŒ‡å®šè¦ç»˜åˆ¶è½®å»“çš„ç¼–å·ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼Œåˆ™ç»˜åˆ¶æ‰€æœ‰çš„è½®å»“
const Scalar& color, 			// ç»˜åˆ¶è½®å»“æ‰€ç”¨çš„é¢œè‰²
int thickness=1, 				// ç»˜åˆ¶è½®å»“çš„çº¿çš„ç²—ç»†ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è½®å»“å†…éƒ¨è¢«å¡«å……(CV_FILLED å¡«å……å†…éƒ¨)
int lineType=8, 				// ç»˜åˆ¶è½®å»“çš„çº¿çš„è¿é€šæ€§(LINE_AA æŠ—é”¯é½¿çº¿å½¢)
InputArray hierarchy=noArray(), 	// å…³äºå±‚çº§çš„å¯é€‰å‚æ•°ï¼Œåªæœ‰ç»˜åˆ¶éƒ¨åˆ†è½®å»“æ—¶æ‰ä¼šç”¨åˆ°ï¼ˆhierarchy=hierarchyï¼Œç»˜åˆ¶æ‰€æœ‰è½®å»“ï¼‰
int maxLevel=INT_MAX, 			// ç»˜åˆ¶è½®å»“çš„æœ€é«˜çº§åˆ«ï¼Œè¿™ä¸ªå‚æ•°åªæœ‰hierarchyæœ‰æ•ˆçš„æ—¶å€™æ‰æœ‰æ•ˆ
Point offset=Point() 			// ä»£è¡¨è½®å»“ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºä»»æ„å€¼
)

```

- `image`	è¦ç»˜åˆ¶è½®å»“çš„å›¾åƒ
- `contours`   æ‰€æœ‰è¾“å…¥çš„è½®å»“ï¼Œæ¯ä¸ªè½®å»“è¢«ä¿å­˜æˆä¸€ä¸ªpointå‘é‡(vector<vector<Point>>)
- `contourIdx`  æŒ‡å®šè¦ç»˜åˆ¶è½®å»“çš„ç¼–å·ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼Œåˆ™ç»˜åˆ¶æ‰€æœ‰çš„è½®å»“
- `color ` ç»˜åˆ¶è½®å»“æ‰€ç”¨çš„é¢œè‰²
- `thickness ` ç»˜åˆ¶è½®å»“çš„çº¿çš„ç²—ç»†ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼Œåˆ™è½®å»“å†…éƒ¨è¢«å¡«å……(CV_FILLED å¡«å……å†…éƒ¨)
- `lineType`  ç»˜åˆ¶è½®å»“çš„çº¿çš„è¿é€šæ€§(LINE_AA æŠ—é”¯é½¿çº¿å½¢)
- `hierarchy`  å…³äºå±‚çº§çš„å¯é€‰å‚æ•°ï¼Œåªæœ‰ç»˜åˆ¶éƒ¨åˆ†è½®å»“æ—¶æ‰ä¼šç”¨åˆ°
- `maxLevel`  ç»˜åˆ¶è½®å»“çš„æœ€é«˜çº§åˆ«ï¼Œè¿™ä¸ªå‚æ•°åªæœ‰hierarchyæœ‰æ•ˆçš„æ—¶å€™æ‰æœ‰æ•ˆ
- `offset`  ä»£è¡¨è½®å»“ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºä»»æ„å€¼

**maxLevel**

| maxLevel=0ï¼Œç»˜åˆ¶ä¸è¾“å…¥è½®å»“å±äºåŒä¸€ç­‰çº§çš„æ‰€æœ‰è½®å»“å³è¾“å…¥è½®å»“å’Œä¸å…¶ç›¸é‚»çš„è½®å»“ |
| ------------------------------------------------------------ |
| maxLevel=1, ç»˜åˆ¶ä¸è¾“å…¥è½®å»“åŒä¸€ç­‰çº§çš„æ‰€æœ‰è½®å»“ä¸å…¶å­èŠ‚ç‚¹ã€‚     |
| maxLevel=2ï¼Œç»˜åˆ¶ä¸è¾“å…¥è½®å»“åŒä¸€ç­‰çº§çš„æ‰€æœ‰è½®å»“ä¸å…¶å­èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ |

```c
//ç¬¬ä¸€æ­¥ï¼šè¾“å…¥å›¾åƒ
	//ç¬¬äºŒæ­¥ï¼šè¾¹ç¼˜æ£€æµ‹ï¼Œå¾—åˆ°è¾¹ç¼˜äºŒå€¼å›¾
	GaussianBlur(img, img, Size(3, 3), 0.5);
	Mat binaryImg;
	Canny(img, binaryImg, 50, 200);
	imshow("æ˜¾ç¤ºè¾¹ç¼˜", binaryImg);
	imwrite("cannyEdge.jpg", binaryImg);
	//ç¬¬ä¸‰æ­¥ï¼šè¾¹ç¼˜çš„è½®å»“
	vector<vector<Point>> contours;
	vector<Vec4i> hei;
	findContours(binaryImg, contours, hei, RETR_EXTERNAL, CHAIN_APPROX_SIMPLE, Point(0, 0));
	
	//ç¬¬å››æ­¥ï¼šå¯¹æ¯ä¸€ä¸ªè½®å»“ä½œæ‹Ÿåˆï¼Œè¿™é‡Œç”¨æ—‹è½¬çŸ©å½¢
	int num = contours.size();//è½®å»“çš„æ•°é‡
	for (int i = 0; i < num; i++)
	{
		//æœ€å°å¤–åŒ…ç›´ç«‹çŸ©å½¢
		Rect rect = boundingRect(Mat(contours[i]));
		if (rect.area() > 2000)//ç­›é€‰å‡ºé¢ç§¯å¤§äº 10000 çš„çŸ©å½¢
		{
			//åœ¨åŸå›¾ä¸­ç”»å‡ºå¤–åŒ…çŸ©å½¢
			rectangle(img, rect, Scalar(255), 2);
			cout << rect.area() << endl;
		}
	}
	imshow("img", img);
	imwrite("img0.jpg", img);
	waitKey(0);
	return 0;
```

![image-20231220152203094](E:\typora\Project\OpenCV4.assets\image-20231220152203094.png)

### 9.4.2 å¤–åŒ…ã€æ‹Ÿåˆè½®å»“

**approxPolyDP()å‡½æ•°:**

â€‹		ä»¥æŒ‡å®šçš„ç²¾åº¦è¿‘ä¼¼ç”Ÿæˆå¤šè¾¹å½¢æ›²çº¿ã€‚å‡½æ•°é€¼è¿‘ä¸€æ¡æ›²çº¿æˆ–å¦ä¸€æ¡æ›²çº¿/é¡¶ç‚¹è¾ƒå°‘çš„å¤šè¾¹å½¢ï¼Œä½¿å®ƒä»¬ä¹‹é—´çš„è·ç¦»å°äºæˆ–ç­‰äºæŒ‡å®šçš„ç²¾åº¦ã€‚å®ƒä½¿ç”¨Douglas-Peuckerç®—æ³•

```c
void approxPolyDP(InputArray curve,OutputArray approxCurve, double epsilon,bool closed);
```

`curve`ï¼šè¾“å…¥çš„ç‚¹é›†ï¼ˆå­˜å‚¨åœ¨std::vectoræˆ–Matä¸­çš„äºŒç»´ç‚¹çš„è¾“å…¥å‘é‡ï¼‰

`approxCurve`ï¼šè¾“å‡ºçš„ç‚¹é›†ï¼Œå½“å‰ç‚¹é›†æ˜¯èƒ½æœ€å°åŒ…å®¹æŒ‡å®šç‚¹é›†çš„ã€‚drawå‡ºæ¥å³æ˜¯ä¸€ä¸ªå¤šè¾¹å½¢

`epsilon`ï¼šæŒ‡å®šçš„ç²¾åº¦ï¼Œä¹Ÿå³æ˜¯åŸå§‹æ›²çº¿ä¸è¿‘ä¼¼æ›²çº¿ä¹‹é—´çš„æœ€å¤§è·ç¦»ã€‚

`closed`ï¼šè‹¥ä¸ºtrue,åˆ™è¯´æ˜è¿‘ä¼¼æ›²çº¿æ˜¯é—­åˆçš„ï¼Œå®ƒçš„é¦–ä½éƒ½æ˜¯ç›¸è¿ï¼Œåä¹‹ï¼Œè‹¥ä¸ºfalseï¼Œåˆ™æ–­å¼€ã€‚

```c++
void Approx(Mat img,string outdir)
{
    Mat gaussImg;
    Mat binaryImg;
    GaussianBlur(img, gaussImg, Size(3, 3), 0.5);
    threshold(gaussImg, binaryImg, 0, 255, THRESH_OTSU);
    Mat kernel = getStructuringElement(MORPH_RECT, Size(5, 5));
    //å½¢æ€å­¦å¼€è¿ç®—ï¼ˆæ¶ˆé™¤ç»†å°ç™½ç‚¹ï¼‰
    morphologyEx(binaryImg, binaryImg, MORPH_OPEN, kernel);
    imwrite(outdir + "canny.jpg", binaryImg);
    // è¾¹ç¼˜çš„è½®å»“
    vector<vector<Point> > contours;
    vector<Vec4i> hierarchy;
    findContours(binaryImg, contours, hierarchy, RETR_EXTERNAL, CHAIN_APPROX_SIMPLE);
    Mat contourImg = Mat::zeros(img.rows, img.cols, CV_8UC1);
    for (int i = 0; i < contours.size(); i++)
    {
        drawContours(contourImg, contours, i, Scalar(255), 2);
        // ç”»å‡ºè½®å»“çš„æœ€å°å¤–åŒ…åœ†
//        Point2f center;
//        float radius;
//        minEnclosingCircle(contours[i], center, radius);
//        circle(img, center, radius, Scalar(255), 2);
        // å¤šè¾¹å½¢é€¼è¿‘
        vector<Point> approxCurve;
        approxPolyDP(contours[i], approxCurve, 0.3, true);
        for (int i = 0; i < approxCurve.size() - 2; i++)
        {
            line(img, approxCurve[i], approxCurve[i + 1], Scalar(0), 2);
        }
        line(img, approxCurve[approxCurve.size() - 1], approxCurve[0], Scalar(0), 2);
    }
    imshow("å›¾åƒ.jpg", img);
    imshow("å›¾åƒè½®å»“.jpg", contourImg);
}
```

è¾“å‡ºç»“æœï¼š

![image-20231220155247005](E:\typora\Project\OpenCV4.assets\image-20231220155247005.png)



### 9.4.3 è½®å»“çš„å‘¨é•¿å’Œé¢ç§¯

å¸¸ç”¨å‡½æ•°è¯¦è§£

**è®¡ç®—ç‚¹é›†æ‰€å›´çš„åŒºåŸŸçš„å‘¨é•¿å’Œé¢ç§¯ã€‚**

```c++
double arcLength(InputArray curve, bool closed)
```

- InputArrayç±»å‹çš„curveï¼Œè¾“å…¥çš„å‘é‡ï¼ŒäºŒç»´ç‚¹ï¼ˆè½®å»“é¡¶ç‚¹ï¼‰ï¼Œå¯ä»¥ä¸ºstd::vectoræˆ–Matç±»å‹ã€‚
- boolç±»å‹çš„closedï¼Œç”¨äºæŒ‡ç¤ºæ›²çº¿æ˜¯å¦å°é—­çš„æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºtrueã€‚

**è®¡ç®—ç‚¹é›†æ‰€å›´æˆçš„åŒºåŸŸçš„é¢ç§¯ã€‚**

```c
//å‡½æ•°åŸå‹1
double ContourArea(InputArray contour,
    bool oriented = false)
 
//å‡½æ•°åŸå‹2
double ContourArea(IEnumerable<Point> contour,
    bool oriented = false)
 
//å‡½æ•°åŸå‹3
double ContourArea(IEnumerable<Point2f> contour,
    bool oriented = false)
```

![image-20231224125108700](E:\typora\Project\OpenCV4.assets\image-20231224125108700.png)

![image-20231224125657987](E:\typora\Project\OpenCV4.assets\image-20231224125657987.png)

### 9.4.4 ç‚¹å’Œè½®å»“çš„ä½ç½®å…³ç³»

ç©ºé—´ä¸­ä»»æ„ä¸€ç‚¹ä¸è¿™ä¸ªè½®å»“æ— éæœ‰ä¸‰ç§å…³ç³»ï¼šç‚¹åœ¨è½®å»“å¤–ã€ç‚¹åœ¨è½®å»“ä¸Šã€ç‚¹åœ¨è½®å»“å¤–ã€‚

OpenCVæä¾›çš„å‡½æ•°ï¼š

```c++
double pointPolygonTest(InputArray contour,Point2f pt, bool measureDist)
```

- contour ä¸ºè½®å»“ã€‚

- pt ä¸ºå¾…åˆ¤å®šçš„ç‚¹ã€‚

- measureDist ä¸ºå¸ƒå°”å‹å€¼ï¼Œè¡¨ç¤ºè·ç¦»çš„åˆ¤å®šæ–¹å¼ã€‚

  â€‹	å½“å€¼ä¸º True æ—¶ï¼Œè¡¨ç¤ºè®¡ç®—ç‚¹åˆ°è½®å»“çš„è·ç¦»ã€‚å¦‚æœç‚¹åœ¨è½®å»“çš„å¤–éƒ¨ï¼Œè¿”å›å€¼ä¸ºè´Ÿæ•°ï¼›å¦‚æœç‚¹åœ¨è½®å»“ä¸Šï¼Œè¿”å›å€¼ä¸º 0ï¼›å¦‚æœç‚¹åœ¨è½®å»“å†…éƒ¨ï¼Œè¿”å›å€¼ä¸ºæ­£æ•°ã€‚

  â€‹	å½“å€¼ä¸º False æ—¶ï¼Œä¸è®¡ç®—è·ç¦»ï¼Œåªè¿”å›â€œ-1â€ã€â€œ0â€å’Œâ€œ1â€ä¸­çš„ä¸€ä¸ªå€¼ï¼Œè¡¨ç¤ºç‚¹ç›¸å¯¹äºè½®å»“çš„ä½ç½®å…³ç³»ã€‚å¦‚æœç‚¹åœ¨è½®å»“çš„å¤–éƒ¨ï¼Œè¿”å›å€¼ä¸ºâ€œ-1â€ï¼›å¦‚æœç‚¹åœ¨è½®å»“ä¸Šï¼Œè¿”å›å€¼ä¸ºâ€œ0â€ï¼›å¦‚æœç‚¹åœ¨è½®å»“å†…éƒ¨ï¼Œè¿”å›å€¼ä¸ºâ€œ1â€ã€‚



![image-20231224215409334](E:\typora\Project\OpenCV4.assets\image-20231224215409334.png)

![image-20231224215423398](E:\typora\Project\OpenCV4.assets\image-20231224215423398.png)



### 9.4.5 è½®å»“çš„å‡¸åŒ…ç¼ºé™·

ç”¨æ¥è¡¡é‡å‡¸åŒ…çš„ç¼ºé™·ï¼ŒOpenCVæä¾›äº†å¦‚ä¸‹å‡½æ•°

```c++
void cv::convexityDefects(InputArray contour,InputArray convexhull,OutputArray convexityDefects);
```

- contourï¼šè¾“å…¥çš„è½®å»“ç‚¹ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡cv::findContours()å‡½æ•°è·å–ã€‚
- convexhullï¼šè¾“å…¥çš„å‡¸åŒ…ç‚¹ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡cv::convexHull()å‡½æ•°è·å–ã€‚
- convexityDefectsï¼šè¾“å‡ºçš„å‡¸ç¼ºé™·ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªNè¡Œ4åˆ—çš„çŸ©é˜µï¼Œæ¯è¡ŒåŒ…å«4ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯å‡¸ç¼ºé™·èµ·ç‚¹ç´¢å¼•ã€ç»ˆç‚¹ç´¢å¼•ã€æœ€è¿œç‚¹ç´¢å¼•å’Œè·ç¦»

å‡½æ•°ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹

1.è¯»å–å›¾åƒå¹¶è½¬æ¢ä¸ºç°åº¦å›¾åƒã€‚

```c++
Mat src = imread("image.jpg");
Mat gray;
cvtColor(src, gray, CV_BGR2GRAY);
```

2.å¯¹ç°åº¦å›¾åƒè¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ã€‚

```c++
Mat binary;threshold(gray, binary, 100, 255, THRESH_BINARY);
```

3.è·å–å›¾åƒä¸­çš„è½®å»“ä¿¡æ¯ã€‚

```c++
vector<vector<Point>> contours;
findContours(binary, contours, RETR_EXTERNAL, CHAIN_APPROX_SIMPLE);
```

4.å¯¹æ¯ä¸ªè½®å»“è®¡ç®—å‡¸åŒ…ç‚¹ä¿¡æ¯ã€‚

```c
vector<vector<int>> hull(contours.size());
for (int i = 0; i < contours.size(); i++)
 {   
  convexHull(contours[i], hull[i], false);
 }
```

5.å¯¹æ¯ä¸ªè½®å»“è®¡ç®—å‡¸ç¼ºé™·ä¿¡æ¯

```c++
vector<vector<Vec4i>> defects(contours.size());for (int i = 0; i < contours.size(); i++) { 
   if (hull[i].size() > 3) {  
         convexityDefects(contours[i], hull[i], defects[i]);  
           }
        }
```

6.éå†æ‰€æœ‰è½®å»“çš„å‡¸ç¼ºé™·ä¿¡æ¯ï¼Œå¹¶ç»˜åˆ¶å‡¸ç¼ºé™·ã€‚

```c++
for (int i = 0; i < contours.size(); i++) {    
	for (int j = 0; j < defects[i].size(); j++) {        
	Vec4i& v = defects[i][j];        
	float depth = v[3] / 256.0;        
	if (depth > 10) {            
	int startidx = v[0];            
	Point start(contours[i][startidx]);            
	int endidx = v[1];            
	Point end(contours[i][endidx]);            
	int faridx = v[2];            
	Point far(contours[i][faridx]);            
	line(src, start, end, Scalar(0, 0, 255), 2);            
	line(src, start, far, Scalar(0, 255, 0), 2);            
	line(src, end, far, Scalar(0, 255, 0), 2);            
	circle(src, far, 4, Scalar(0, 255, 0), -1);  
		}    
	}
}
```









# åã€å‚…é‡Œå¶å˜æ¢

å‚…é‡Œå¶å˜æ¢æ˜¯çº¿æ€§ç³»ç»Ÿåˆ†æçš„ä¸€ä¸ªæœ‰åŠ›å·¥å…·ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå®šé‡åˆ†ææ•°å­—åŒ–ç³»ç»Ÿã€‚

## 10.1äºŒç»´ç¦»æ•£çš„å‚…é‡Œå¶(é€†)å˜æ¢



â€‹		OpenCVæä¾›äº†å¦‚ä¸‹å‡½æ•°æ¥å®ç°çŸ©é˜µçš„å‚…é‡Œå¶ï¼ˆé€†)å˜æ¢

```c
void cv::dft(cv::InputArray src, cv::OutputArray dst, int flags = 0, int nonzeroRows = 0)
```

srcï¼šè¾“å…¥çŸ©é˜µï¼Œåªæ”¯æŒ CV_32F æˆ–è€… CV_64F çš„å•é€šé“æˆ–åŒé€šé“çŸ©é˜µ

dstï¼šè¾“å‡ºçŸ©é˜µ

flagsï¼šç”¨äºè¯´æ˜æ˜¯å‚…é‡Œå¶å˜æ¢è¿˜æ˜¯å‚…é‡Œå¶é€†å˜æ¢

- DFT_COMPLEX_OUTPUTï¼šè¾“å‡ºå¤æ•°å½¢å¼
- DFT_REAL_OUTPUTï¼šåªè¾“å‡ºå®éƒ¨
- DFT_INVERSEï¼šå‚…é‡Œå¶é€†å˜æ¢
- DFT_SCALEï¼šæ˜¯å¦é™¤ä»¥ ğ‘€*ğ‘
- DFT_ROWSï¼šè¾“å…¥çŸ©é˜µçš„æ¯è¡Œè¿›è¡Œå‚…é‡Œå¶å˜æ¢æˆ–è€…é€†å˜æ¢



â€‹		åœ¨ OpenCV ä¸­å®ç°çš„å‚…é‡Œå¶å˜æ¢çš„å¿«é€Ÿç®—æ³•æ˜¯é’ˆå¯¹è¡Œæ•°å’Œåˆ—æ•°å‡æ»¡è¶³å¯ä»¥åˆ†è§£ä¸º 2ğ‘ Ã— 3ğ‘ Ã— 5ğ‘Ÿ çš„æƒ…å†µçš„ã€‚æ‰€ä»¥è®¡ç®—äºŒç»´çŸ©é˜µçš„å¿«é€Ÿå‚…é‡Œå¶å˜æ¢æ—¶éœ€è¦å…ˆå¯¹åŸçŸ©é˜µè¿›è¡Œæ‰©å……ï¼Œåœ¨çŸ©é˜µçš„å³ä¾§å’Œä¸‹ä¾§è¡¥ 0ï¼Œä»¥æ»¡è¶³è¯¥è§„åˆ™ã€‚å¯¹äºè¡¥å¤šå°‘è¡Œå¤šå°‘åˆ—çš„ 0ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°ï¼š

```c
int cv::getOptimalDFTSize(int vecsize)
```



## 10.2 å‚…é‡Œå¶å¹…åº¦è°±ä¸ç›¸ä½è°±

ä¸‹é¢å¯¹å¹…åº¦è°±å’Œç›¸ä½è°±è¿›è¡Œç°åº¦çº§æ˜¾ç¤ºï¼š

â€‹		OpenCVä¸­ç›´æ¥è®¡ç®—ä¸¤ä¸ªçŸ©é˜µå¯¹åº”ä½ç½®å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼š

```c
void cv::magnitude(cv::InputArray x, cv::InputArray y, cv::OutputArray magnitude)
```

- xï¼šæµ®ç‚¹å‹çŸ©é˜µ
- yï¼šæµ®ç‚¹å‹çŸ©é˜µ
- magnitudeï¼šå¹…åº¦è°±

â€‹		å› ä¸ºå¯¹å›¾åƒè¿›è¡Œå‚…é‡Œå¶å˜æ¢åå¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¤æ•°çŸ©é˜µï¼Œä¿å­˜åœ¨ä¸€ä¸ªåŒé€šé“ Mat ç±»ä¸­ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å‡½æ•° `magnitude` è®¡ç®—å¹…åº¦è°±æ—¶ï¼Œéœ€è¦åˆ©ç”¨ OpenCV æä¾›çš„å‡½æ•° `split` å°†å‚…é‡Œå¶å˜æ¢çš„å®éƒ¨å’Œè™šéƒ¨åˆ†å¼€ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š

```c
void amplitudeSpectrum(InputArray _srcFFT, OutputArray _dstSpectrum)
{
    //åˆ¤æ–­å‚…é‡Œå¶å˜æ¢æœ‰ä¸¤ä¸ªé€šé“
    CV_Assert(_srcFFT.channels() == 2);
    //åˆ†ç¦»é€šé“
    vector<Mat> FFT2Channel;
    split(_srcFFT, FFT2Channel);
    //è®¡ç®—å‚…é‡Œå¶å˜æ¢çš„å¹…åº¦è°± sqrt(pow(R,2)+pow(I,2))
    magnitude(FFT2Channel[0], FFT2Channel[1], _dstSpectrum);
}
```

â€‹		å¯¹äºå‚…é‡Œå¶è°±çš„ç°åº¦çº§æ˜¾ç¤ºï¼ŒOpenCV æä¾›äº†å‡½æ•° `log`ï¼Œè¯¥å‡½æ•°å¯ä»¥è®¡ç®—çŸ©é˜µä¸­æ¯ä¸€ä¸ªå€¼çš„å¯¹æ•°ã€‚è¿›è¡Œå½’ä¸€åŒ–åï¼Œä¸ºäº†ä¿å­˜å‚…é‡Œå¶è°±çš„ç°åº¦çº§ï¼Œæœ‰æ—¶éœ€è¦å°†çŸ©é˜µä¹˜ä»¥ 255ï¼Œç„¶åè½¬æ¢ä¸º 8 ä½å›¾ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```c++
Mat graySpectrum(Mat spectrum)
{
    Mat dst;
    log(spectrum + 1, dst);
    //å½’ä¸€åŒ–
    normalize(dst, dst, 0, 1, NORM_MINMAX);
    //ä¸ºäº†è¿›è¡Œç°åº¦çº§æ˜¾ç¤ºï¼Œåšç±»å‹è½¬æ¢
    dst.convertTo(dst, CV_8UC1, 255, 0);
    return dst;
}
```

OpenCVæä¾›çš„è®¡ç®—ç›¸ä½è°±çš„å‡½æ•°ï¼š

```c++
void cv::phase(cv::InputArray x, cv::InputArray y, cv::OutputArray angle, bool angleInDegrees = false)
```

- xï¼šè¾“å…¥çŸ©é˜µï¼ˆå‚…é‡Œå¶å˜æ¢çš„å®éƒ¨çŸ©é˜µï¼‰
- yï¼šè¾“å…¥çŸ©é˜µï¼ˆå‚…é‡Œå¶å˜æ¢çš„è™šéƒ¨çŸ©é˜µï¼‰
- angleï¼šè¾“å‡ºçŸ©é˜µ
- angleInDegreesï¼šæ˜¯å¦å°†è§’åº¦è½¬æ¢åˆ° [-180, 180]



æ•´ä½“è¿è¡Œå‡½æ•°

```c
void Spectrum(Mat img)
{
	//å°†å›¾åƒè½¬æ¢ä¸ºæµ®ç‚¹å‹
	Mat fImg;
	img.convertTo(fImg, CV_64FC1, 1.0, 0);
	//ä¹˜ä»¥ -1^(r+c)
	int rows = fImg.rows;
	int cols = fImg.cols;
	for (int r = 0; r < rows; r++)
	{
		for (int c = 0; c < cols; c++)
		{
			if ((r + c) % 2)
				fImg.at<double>(r, c) *= -1;
		}
	}
	//å¿«é€Ÿå‚…é‡Œå¶å˜æ¢
	Mat fft2;
	fft2Image(fImg, fft2);
	//å‚…é‡Œå¶å˜æ¢çš„å¹…åº¦è°±
	Mat ampSpec;
	amplitudeSpectrum(fft2, ampSpec);
	//å¹…åº¦è°±çš„ç°åº¦çº§æ˜¾ç¤º
	Mat graySpec = graySpectrum(ampSpec);
	imshow("å¹…åº¦è°±çš„ç°åº¦çº§æ˜¾ç¤º", graySpec);
	//ç›¸ä½è°±
	Mat phaSpec = phaseSpectrum(fft2);
	//ç›¸ä½è°±çš„ç°åº¦çº§æ˜¾ç¤º
	imshow("ç›¸ä½è°±", phaSpec);
}

```

è¾“å‡ºç»“æœï¼š

![image-20231225124210715](E:\typora\Project\OpenCV4.assets\image-20231225124210715.png)

## 10.3 è°±æ®‹å·®æ˜¾è‘—æ€§æ£€æµ‹

ç”Ÿç‰©è§†è§‰ç ”ç©¶è¡¨æ˜ï¼Œè§†è§‰æ³¨æ„æœºåˆ¶æ˜¯ä¸€ç§å…·æœ‰é€‰æ‹©æ€§çš„æ³¨æ„ï¼Œå®ƒé¦–å…ˆç”±è§†è§‰å†…å®¹ä¸­æœ€æ˜¾è‘—çš„ã€ä¸å…¶å‘¨å›´å…¶ä»–å†…å®¹ç›¸æ¯”å·®å¼‚æ›´å¤§çš„æˆåˆ†å¼•èµ·ï¼Œç„¶åæ ¹æ®ä¸»è§‚æ„è¯†å»é€‰æ‹©æ³¨æ„ã€‚

è§†è§‰æ˜¾è‘—æ€§æ£€æµ‹å¯ä»¥çœ‹ä½œæŠ½å–ä¿¡æ¯ä¸­æœ€å…·å·®å¼‚åŒ–çš„éƒ¨åˆ†æˆ–è€…æœ€æ„Ÿå…´è¶£çš„æˆ–é¦–å…ˆå…³æ³¨çš„éƒ¨åˆ†ï¼Œèµ‹äºˆå¯¹å›¾åƒåˆ†æçš„é€‰æ‹©æ€§èƒ½åŠ›ï¼Œå¯¹æé«˜å›¾åƒçš„å¤„ç†æ•ˆç‡æ˜¯æä¸ºé‡è¦çš„ã€‚

### 10.3.1 åŸç†è¯¦è§£

**ç¬¬ä¸€æ­¥ï¼š**è®¡ç®—å›¾åƒçš„å¿«é€Ÿå‚…é‡Œå¶å˜æ¢çŸ©é˜µ F ã€‚

**ç¬¬äºŒæ­¥ï¼š**è®¡ç®—å‚…é‡Œå¶å˜æ¢çš„å¹…åº¦è°±çš„ç°åº¦çº§ graySpectrumã€‚

**ç¬¬ä¸‰æ­¥ï¼š**è®¡ç®—ç›¸ä½è°± phaseSpectrumï¼Œç„¶åæ ¹æ®ç›¸ä½è°±è®¡ç®—å¯¹åº”çš„æ­£å¼¦è°±å’Œä½™å¼¦è°±ã€‚

**ç¬¬å››æ­¥ï¼š**å¯¹ç¬¬äºŒæ­¥è®¡ç®—å‡ºçš„ç°åº¦çº§è¿›è¡Œå‡å€¼å¹³æ»‘ï¼Œè®°ä¸º ğ‘“mean(graySpectrum)ã€‚

**ç¬¬äº”æ­¥ï¼š**è®¡ç®—è°±æ®‹å·®ï¼ˆspectralResidualï¼‰ã€‚è°±æ®‹å·®çš„å®šä¹‰æ˜¯ç¬¬äºŒæ­¥å¾—åˆ°çš„å¹…åº¦è°±çš„ç°åº¦çº§å‡å»ç¬¬å››æ­¥å¾—åˆ°çš„å‡å€¼å¹³æ»‘ç»“æœï¼Œå³ï¼š
$$
spectralResidual = graySpectrum âˆ’ f_{mean} ( graySpectrum )
$$
**ç¬¬å…­æ­¥ï¼š**å¯¹è°±æ®‹å·®è¿›è¡Œå¹‚æŒ‡æ•°è¿ç®— exp(spectralResidual)ï¼Œå³å¯¹è°±æ®‹å·®çŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªå€¼è¿›è¡ŒæŒ‡æ•°è¿ç®—ã€‚

**ç¬¬ä¸ƒæ­¥ï¼š**å°†ç¬¬å…­æ­¥å¾—åˆ°çš„å¹‚æŒ‡æ•°ä½œä¸ºæ–°çš„â€œå¹…åº¦è°±â€ï¼Œä»ç„¶ä½¿ç”¨åŸå›¾çš„ç›¸ä½è°±ï¼Œæ ¹æ®æ–°çš„â€œå¹…åº¦è°±â€å’Œç›¸ä½è°±è¿›è¡Œå‚…é‡Œå¶é€†å˜æ¢ï¼Œå¯å¾—åˆ°ä¸€ä¸ªå¤æ•°çŸ©é˜µã€‚

**ç¬¬å…«æ­¥ï¼š**å¯¹äºç¬¬ä¸ƒæ­¥å¾—åˆ°çš„å¤æ•°çŸ©é˜µï¼Œè®¡ç®—è¯¥çŸ©é˜µçš„å®éƒ¨å’Œè™šéƒ¨çš„å¹³æ–¹å’Œçš„å¼€æ–¹ï¼Œç„¶åè¿›è¡Œé«˜æ–¯å¹³æ»‘ï¼Œæœ€åè¿›è¡Œç°åº¦çº§çš„è½¬æ¢ï¼Œå³å¾—åˆ°æ˜¾è‘—æ€§ã€‚

### 10.3.2 ä»£ç å®ç°

```c
void SaliencyMap(Mat image)
{
	//è½¬æ¢ä¸º double ç±»å‹
	Mat fImage;
	image.convertTo(fImage, CV_64FC1, 1.0 / 255);
	//å¿«é€Ÿå‚…é‡Œå¶å˜æ¢
	Mat fft2;
	fft2Image(fImage, fft2);
	//å¹…åº¦è°±ï¼ˆåˆç§°å‚…é‡Œå¶è°±ï¼‰
	Mat amplitude;
	amplitudeSpectrum(fft2, amplitude);
	//å¯¹å¹…åº¦è°±è¿›è¡Œå¯¹æ•°è¿ç®—
	Mat logAmplitude;
	cv::log(amplitude + 1.0, logAmplitude);
	//å‡å€¼å¹³æ»‘
	Mat meanLogAmplitude;
	cv::blur(logAmplitude, meanLogAmplitude, Size(3, 3), Point(-1, -1));
	//è°±æ®‹å·®
	Mat spectralResidual = logAmplitude - meanLogAmplitude;
	//ç›¸ä½è°±
	Mat phase = phaseSpectrum(fft2);
	//ä½™å¼¦è°± cos(phase)
	Mat cosSpectrum(phase.size(), CV_64FC1);
	//æ­£å¼¦è°± sin(phase)
	Mat sinSpectrum(phase.size(), CV_64FC1);
	for (int r = 0; r < phase.rows; r++)
	{
		for (int c = 0; c < phase.cols; c++)
		{
			cosSpectrum.at<double>(r, c) = cos(phase.at<double>(r, c));
			sinSpectrum.at<double>(r, c) = sin(phase.at<double>(r, c));
		}
	}
	//æŒ‡æ•°è¿ç®—
	exp(spectralResidual, spectralResidual);
	Mat real = spectralResidual.mul(cosSpectrum);
	Mat imaginary = spectralResidual.mul(sinSpectrum);
	vector<Mat> realAndImag;
	realAndImag.push_back(real);
	realAndImag.push_back(imaginary);
	Mat complex;
	merge(realAndImag, complex);
	//å¿«é€Ÿå‚…é‡Œå¶é€†å˜æ¢
	Mat ifft2;
	dft(complex, ifft2, DFT_COMPLEX_OUTPUT + DFT_INVERSE);
	//å‚…é‡Œå¶é€†å˜æ¢çš„å¹…åº¦
	Mat ifft2Amp;
	amplitudeSpectrum(ifft2, ifft2Amp);
	//å¹³æ–¹è¿ç®—
	pow(ifft2Amp, 2.0, ifft2Amp);
	//é«˜æ–¯å¹³æ»‘
	GaussianBlur(ifft2Amp, ifft2Amp, Size(11, 11), 2.5);
	//æ˜¾è‘—æ€§æ˜¾ç¤º
	normalize(ifft2Amp, ifft2Amp, 1.0, 0, NORM_MINMAX);
	//æå‡å¯¹æ¯”åº¦ï¼Œè¿›è¡Œä¼½é©¬å˜æ¢
	pow(ifft2Amp, 0.5, ifft2Amp);
	//æ•°æ®ç±»å‹è½¬æ¢
	Mat saliencyMap;
	ifft2Amp.convertTo(saliencyMap, CV_8UC1, 255);
	imshow("æ˜¾è‘—æ€§", saliencyMap);
}
```

### 10.3.3 è¾“å‡ºç»“æœ

![image-20231225131853774](E:\typora\Project\OpenCV4.assets\image-20231225131853774.png)



# åä¸€ã€é¢‘ç‡åŸŸæ»¤æ³¢

## 11.1 æ¦‚è¿°åŠåŸç†è¯¦è§£

ä½é¢‘ï¼šå›¾åƒçš„å‚…é‡Œå¶å˜æ¢â€œä¸­å¿ƒä½ç½®â€é™„è¿‘çš„åŒºåŸŸã€‚

é«˜é¢‘ï¼šéšç€åˆ°ä¸­å¿ƒä½ç½®çš„è·ç¦»çš„å¢åŠ è€Œå¢åŠ ï¼Œå³å‚…é‡Œå¶å˜æ¢ä¸­å¿ƒä½ç½®çš„å¤–å›´åŒºåŸŸã€‚

é¢‘ç‡åŸŸæ»¤æ³¢å™¨åœ¨ç¨‹åºæˆ–è€…æ•°å­¦è¿ç®—ä¸­å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªçŸ©é˜µï¼Œä¸‹é¢æ‰€æ¶‰åŠçš„å¸¸ç”¨çš„ä½é€šã€é«˜é€šã€å¸¦é€šã€å¸¦é˜»ç­‰æ»¤æ³¢çš„å…³é”®æ­¥éª¤ï¼Œå°±æ˜¯é€šè¿‡ä¸€å®šçš„å‡†åˆ™æ„é€ è¯¥å‡½æ•°çš„ã€‚

![image-20231225155339389](E:\typora\Project\OpenCV4.assets\image-20231225155339389.png)



## 11.2 ä½é€šæ»¤æ³¢å’Œé«˜é€šæ»¤æ³¢

ä½é¢‘ä¿¡æ¯è¡¨ç¤ºçš„æ˜¯å›¾åƒä¸­ç°åº¦å€¼ç¼“æ…¢å˜åŒ–çš„åŒºåŸŸï¼›é«˜é¢‘ä¿¡æ¯è¡¨ç¤ºå›¾åƒä¸­å˜åŒ–è¿…é€Ÿçš„éƒ¨åˆ†ã€‚

ä½é€šæ»¤æ³¢ä¿ç•™ä½é¢‘ä¿¡æ¯ï¼Œå»é™¤é«˜é¢‘ä¿¡æ¯ï¼›é«˜é¢‘æ»¤æ³¢ä¿ç•™é«˜é¢‘ä¿¡æ¯ï¼Œå»é™¤ä½é¢‘ä¿¡æ¯ã€‚



### 11.2.1 ä¸‰ç§å¸¸ç”¨çš„ä½é€šæ»¤æ³¢å™¨

ï¼ˆ1ï¼‰ç†æƒ³ä½é€šæ»¤æ³¢å™¨

![image-20231225160427688](E:\typora\Project\OpenCV4.assets\image-20231225160427688.png)

ï¼ˆ2ï¼‰å·´ç‰¹æ²ƒæ–¯æ»¤æ³¢å™¨

![image-20231225160437085](E:\typora\Project\OpenCV4.assets\image-20231225160437085.png)

  (3)  é«˜æ–¯ä½é€šæ»¤æ³¢å™¨

![image-20231225160504994](E:\typora\Project\OpenCV4.assets\image-20231225160504994.png)

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```c
Mat createLPFilter(Size size, Point center, float radius, int type, int n=2)
{
    Mat lpFilter = Mat::zeros(size, CV_32FC1);
    int rows = size.height;
    int cols = size.width;
    if (radius <= 0)
    return lpFilter;
    //æ„å»ºç†æƒ³ä½é€šæ»¤æ³¢å™¨
    if (type == ILP_FILTER)
    {
        for (int r = 0; r < rows; r++)
        {
            for (int c = 0; c < cols; c++)
            {
                float norm2 = pow(abs(float(r - center.y)), 2) + pow(abs(float(c - center.x)), 2);
                if (sqrt(norm2) < radius)
                    lpFilter.at<float>(r, c) = 1;
                else
                    lpFilter.at<float>(r, c) = 0;
            } 
        } 
    }
    //æ„å»ºå·´ç‰¹æ²ƒæ–¯ä½é€šæ»¤æ³¢å™¨
    if (type == BLP_FILTER)
    {
        for (int r = 0; r < rows; r++)
        {
            for (int c = 0; c<cols; c++)
            {
                lpFilter.at<float>(r, c) = float(1.0 / (1.0 + pow(sqrt(pow(r - center.y, 2.0) + pow(c - center.x, 2.0)) /radius, 2.0*n)));
            } 
        } 
    }
    //æ„å»ºé«˜æ–¯ä½é€šæ»¤æ³¢å™¨
    if (type == GLP_FILTER)
    {
        for (int r = 0; r< rows; r++)
        {
            for (int c = 0; c < cols; c++)
            {
                lpFilter.at<float>(r, c) = float(exp(-(pow(c - center.x, 2.0) + pow(r - center.y, 2.0)) / (2 * pow(radius, 2.0))));
            } 
        } 
    }
    return lpFilter;
}

```



### 11.2.2 ä¸‰ç§å¸¸ç”¨çš„é«˜é€šæ»¤æ³¢å™¨

ï¼ˆ1ï¼‰ç†æƒ³é«˜é€šæ»¤æ³¢å™¨

![image-20231225165218667](E:\typora\Project\OpenCV4.assets\image-20231225165218667.png)

ï¼ˆ2ï¼‰å·´ç‰¹æ²ƒæ–¯é«˜é€šæ»¤æ³¢å™¨

![image-20231225165229448](E:\typora\Project\OpenCV4.assets\image-20231225165229448.png)

ï¼ˆ3ï¼‰é«˜æ–¯é«˜é€šæ»¤æ³¢å™¨

![image-20231225165240001](E:\typora\Project\OpenCV4.assets\image-20231225165240001.png)

â€‹		ä»£ç æ–¹é¢åªéœ€è¦å°†ä½é€šæ»¤æ³¢çš„æ»¤æ³¢éƒ¨åˆ†æ”¹ä¸ºé«˜é€šæ»¤æ³¢ã€‚



## 11.3 å¸¦é€šå’Œå¸¦é˜»æ»¤æ³¢

### 11.3.1 ä¸‰ç§å¸¸ç”¨çš„å¸¦é€šæ»¤æ³¢å™¨

â€‹		å¸¦é€šæ»¤æ³¢æ˜¯æŒ‡åªä¿ç•™æŸä¸€èŒƒå›´åŒºåŸŸçš„é¢‘ç‡å¸¦

ï¼ˆ1ï¼‰ç†æƒ³å¸¦é€šæ»¤æ³¢å™¨

![image-20231225170026381](E:\typora\Project\OpenCV4.assets\image-20231225170026381.png)

ï¼ˆ2ï¼‰å·´ç‰¹æ²ƒæ–¯å¸¦é€šæ»¤æ³¢å™¨

<img src="E:\typora\Project\OpenCV4.assets\image-20231225165942037.png" alt="image-20231225165942037" style="zoom:120%;" />

ï¼ˆ3)  é«˜é€šå¸¦é€šæ»¤æ³¢å™¨

<img src="E:\typora\Project\OpenCV4.assets\image-20231225165952514.png" alt="image-20231225165952514" style="zoom:150%;" />

### 11.3.2 ä¸‰ç§å¸¸ç”¨çš„å¸¦é˜»æ»¤æ³¢å™¨

ï¼ˆ1ï¼‰ç†æƒ³å¸¦é˜»æ»¤æ³¢å™¨

![image-20231225170748109](E:\typora\Project\OpenCV4.assets\image-20231225170748109.png)

ï¼ˆ2ï¼‰å·´ç‰¹æ²ƒæ–¯å¸¦é˜»æ»¤æ³¢å™¨

![image-20231225170803773](E:\typora\Project\OpenCV4.assets\image-20231225170803773.png)

ï¼ˆ3ï¼‰é«˜æ–¯å¸¦é˜»æ»¤æ³¢å™¨

![image-20231225170819933](E:\typora\Project\OpenCV4.assets\image-20231225170819933.png)





# åäºŒã€è‰²å½©ç©ºé—´

## 12.1 å¸¸è§çš„è‰²å½©ç©ºé—´

ç°åº¦å›¾åƒçš„æ¯ä¸€ä¸ªåƒç´ éƒ½æ˜¯ç”±ä¸€ä¸ªæ•°å­—é‡åŒ–æˆçš„ï¼Œè€Œå½©è‰²å›¾åƒçš„æ¯ä¸€ä¸ªåƒç´ éƒ½æ˜¯ç”±ä¸‰ä¸ªæ•°å­—é‡åŒ–çš„ã€‚æ¯”è¾ƒå¸¸ç”¨çš„ä¸‰è‰²è‰²å½©ç©ºé—´åŒ…æ‹¬RGBã€HSVã€HLSã€Labã€YUVç­‰ã€‚

### 12.1.1 RGBè‰²å½©ç©ºé—´

### 12.1.2 HSVè‰²å½©ç©ºé—´

### 12.1.3 HLSè‰²å½©ç©ºé—´



## 12.2 è°ƒæ•´å½©è‰²å›¾åƒçš„é¥±å’Œåº¦å’Œäº®åº¦

å› ä¸ºåœ¨HLSå’ŒHSVè‰²å½©ç©ºé—´ä¸­éƒ½å°†é¥±å’Œåº¦å’Œäº®åº¦å•ç‹¬åˆ†ç¦»å‡ºæ¥ï¼Œæ‰€ä»¥é¦–å…ˆå°†RGBå›¾åƒè½¬åŒ–ä¸ºHLSæˆ–è€…HSVå›¾åƒï¼Œç„¶åè°ƒæ•´é¥±å’Œåº¦å’Œäº®åº¦åˆ†é‡ï¼Œæœ€åå°†è°ƒæ•´åçš„HLSæˆ–è€…HSVå›¾åƒè½¬åŒ–ä¸ºRGBå›¾åƒã€‚





1.

![image-20231215145052107](E:\typora\Project\OpenCV4.assets\image-20231215145052107.png)

â€‹		è§£å†³æ–¹æ³•ï¼šæ£€æŸ¥con2Dçš„ç”³æ˜å’Œå®šä¹‰ä¸­æ˜¯å¦é‡å¤èµ‹ç»™äº†æŸä¸ªå‚æ•°åˆå€¼ã€‚å»æ‰èµ‹çš„åˆå€¼åï¼ŒæŠ¥é”™è§£é™¤ã€‚



2.

![image-20231215164731139](E:\typora\Project\OpenCV4.assets\image-20231215164731139.png)

â€‹		è§£å†³æ–¹æ³•ï¼šåœ¨å¤´æ–‡ä»¶ä¸­#include <opencv2/core/types.hpp>



3.

![img](https://img-blog.csdn.net/20170824100630314?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2luYXRfMzYyNjQ2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

â€‹		è§£å†³æ–¹æ³•ï¼šçŸ©é˜µè¶Šä½æˆ–è€…çŸ©é˜µå…ƒç´ ä¸å¤Ÿï¼Œæ£€æŸ¥ä¸€ä¸‹çŸ©é˜µçš„å…ƒç´ æ˜¯å¦æ•°é‡æ­£ç¡®



4.

![image-20231217223013973](E:\typora\Project\OpenCV4.assets\image-20231217223013973.png)

â€‹		è§£å†³æ–¹æ³•ï¼š\#include <opencv2/imgproc/imgproc_c.h>



5.

![image-20231218001437655](E:\typora\Project\OpenCV4.assets\image-20231218001437655.png)

â€‹		è§£å†³æ–¹æ³•ï¼šmain()æ‰“é”™äº†ï¼Œå¾ˆä½çº§çš„é”™è¯¯ã€‚

6.

![image-20231218172820064](E:\typora\Project\OpenCV4.assets\image-20231218172820064.png)

â€‹		è§£å†³æ–¹æ³•ï¼šç”±äºä¸åŒOpenCVç‰ˆæœ¬ä¸åŒï¼ŒCV_THRESH_BINARY_INV ä¿®æ”¹ä¸ºcv::THRESH_BINARY_INV

